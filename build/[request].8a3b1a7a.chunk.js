(self.webpackChunkmynote=self.webpackChunkmynote||[]).push([[6750],{56987:(k,Q,a)=>{"use strict";a.r(Q),a.d(Q,{default:()=>Qe});var t=a(53547),p=a(16550),o=a(88767),ae=a(17034),e=a(28897),R=a(86896),ne=a(86706),se=a(27361),B=a.n(se),le=a(78718),re=a.n(le),oe=a(44908),ie=a.n(oe),ue=a(73955),de=a.n(ue),ce=a(94649),n=a(67281),q=a(14087),_=a(41580),ee=a(29728),me=a(23620),ge=a(7681),W=a(53979),P=a(49066),pe=a(67109),fe=a(85018),f=a(95256),Ee=a(36807);const ye=["_blank","_parent","_self","_top"],he=[{input:{intlLabel:{id:(0,e.OB)("form.label.title"),defaultMessage:"Title"},name:"title",type:"text",required:!0},grid:{col:6,s:12}},{input:{intlLabel:{id:(0,e.OB)("form.label.slug"),defaultMessage:"Slug"},name:"slug",type:"uid",contentTypeUID:"plugin::menus.menu",attribute:{targetField:"title"},required:!0},grid:{col:6,s:12}}],ve=[{input:{intlLabel:{id:(0,e.OB)("form.label.title"),defaultMessage:"Title"},name:"title",type:"text",placeholder:{id:(0,e.OB)("form.placeholder.untitled"),defaultMessage:"Untitled"},required:!0}},{input:{intlLabel:{id:(0,e.OB)("form.label.url"),defaultMessage:"URL"},name:"url",type:"text"}},{input:{intlLabel:{id:(0,e.OB)("form.label.target"),defaultMessage:"Target"},name:"target",type:"select",options:ye.map(s=>({key:s,value:s,metadatas:{intlLabel:{id:(0,e.OB)(`form.label.option.${s}`),defaultMessage:s}}}))},grid:{col:6}}],U={menu:he,menuItem:ve};var m=a(87561),x=a(89414);const Me=m.object().shape({order:m.number(n.translatedErrors.number).required(n.translatedErrors.required),title:m.string(n.translatedErrors.string).required(n.translatedErrors.required),url:m.string(n.translatedErrors.string).test("is-url",(0,e.OB)("error.url.invalid"),s=>!!(!s||x.Ks.test(s)||x.dM.test(s)||x.jv.test(s)||x.kR.test(s))).nullable(),target:m.string(n.translatedErrors.string).nullable()}),Be=m.object().shape({title:m.string(n.translatedErrors.string).nullable().required(n.translatedErrors.required),slug:m.string(n.translatedErrors.string).nullable().required(n.translatedErrors.required),items:m.array().of(Me)}),Oe={title:"",slug:"",items:[]},Ae="menus-clone-{id}",Ce="menus-create",Ie="menus-edit-{id}",Se=({history:s,location:d,match:K})=>{const{id:c}=K.params,{formatMessage:E}=(0,R.Z)(),{notifyStatus:$}=(0,q.G)(),O=(0,n.useNotification)(),{lockApp:T,unlockApp:v}=(0,n.useOverlayBlocker)(),D=(0,o.useQueryClient)(),{config:V,schema:i}=(0,ne.useSelector)(r=>r[`${e.aw}_config`]),F=B()(V,"layouts.menuItem",{}),b=(0,t.useMemo)(()=>(0,e.Vi)(U.menuItem,F,i),[F]),Z=Object.values(b).flat(),y=!c,g=d.pathname.split("/").includes("clone");let A=E({id:(0,e.OB)("edit.header.title"),defaultMessage:"Edit menu"}),C=Ie.replace("{id}",c);y&&(A=E({id:(0,e.OB)("create.header.title"),defaultMessage:"Create menu"}),C=Ce),g&&(A=E({id:(0,e.OB)("clone.header.title"),defaultMessage:"Clone menu"}),C=Ae.replace("{id}",c));const j=(0,e.Bi)(i.menuItem,["media"]),G={populate:ie()(["items","items.parent",...j.map(r=>`items.${r}`)])},{status:I,data:l}=(0,o.useQuery)(C,()=>e.hi.get(c,G),{enabled:!y,select:r=>(0,e.m5)(r),onSuccess:()=>{$(E({id:(0,e.OB)("ui.loaded"),defaultMessage:"Data has been loaded"}))},onError:()=>{O({type:"warning",message:{id:(0,e.OB)("ui.error"),defaultMessage:"An error occured"}})}}),z=(0,o.useMutation)(r=>{if(g){const S=re()(r.data,["title","slug"],{}),u=r.data.items.map(h=>({id:h.id,createId:de()("create")})),M=r.data.items.map(h=>{const N=u.find(J=>J.id===h.id),L=u.find(J=>J.id===h.parent?.id),w=N?N.createId:null,X=L?{id:L.createId}:null;return{...(0,e.oW)(h),id:w,parent:X}}),H={data:{...S,items:M}};return e.hi.postAction(H)}return y?e.hi.postAction(r):e.hi.putAction(c,r)},{refetchActive:!0,onSuccess:async()=>{await D.invalidateQueries(C),O({type:"success",message:{id:(0,e.OB)("ui.saved"),defaultMessage:"Saved"}})},onError:()=>{O({type:"warning",message:{id:(0,e.OB)("ui.error"),defaultMessage:"An error occured"}})},onSettled:()=>{v()}}),Re=async(r,{setErrors:S})=>{T();try{const u=(0,e.oW)(r),M=(0,e.BR)(u,l,U.menu,g),H=B()(u,"items",[]).map(N=>{const L=(0,e.oW)(N),w=B()(l,"items",[]).find(X=>X.id===L.id);return(0,e.BR)(L,w,Z,g)}),h=await z.mutateAsync({data:{...M,items:H}});(y||g)&&h?.data?.data?.id&&s.push(`/plugins/${e.aw}/edit/${h.data.data.id}`)}catch(u){v();const M=u?.response?.data?.error?.details;M?S(M):console.error(u)}};return t.createElement(f.Ar,{isLoading:!y&&I!=="success",title:A},t.createElement(Ee.rE,null),t.createElement(ce.Formik,{onSubmit:Re,initialValues:l??Oe,validateOnChange:!1,validationSchema:Be,enableReinitialize:!0},({handleSubmit:r})=>t.createElement(n.Form,{onSubmit:r},t.createElement(f.Cp,{isCreatingEntry:y,isCloningEntry:g,menu:l},({dirty:S,isSubmitting:u})=>t.createElement(t.Fragment,null,t.createElement(W.T,{title:A,navigationAction:t.createElement(me.r,{startIcon:t.createElement(pe.Z,null),to:`/plugins/${e.aw}`},E({id:(0,e.OB)("ui.goBack"),defaultMessage:"Go back"})),primaryAction:t.createElement(ee.z,{type:"submit",disabled:!S||u,loading:u,startIcon:t.createElement(fe.default,null),size:"L"},E({id:(0,e.OB)("ui.save"),defaultMessage:"Save"}))}),t.createElement(P.D,null,t.createElement(_.x,{paddingBottom:10},t.createElement(ge.K,{spacing:8},t.createElement(f.$0,null,t.createElement(f.lt,{fields:U.menu,schema:i.menu})),t.createElement(f.qT,{fields:b})))))))))},Y=(0,t.memo)(Se);var Le=a(96315);const te="menus-index",xe=({history:s})=>{const{formatMessage:d}=(0,R.Z)(),{notifyStatus:K}=(0,q.G)(),c=(0,n.useNotification)(),{lockApp:E,unlockApp:$}=(0,n.useOverlayBlocker)(),O=(0,o.useQueryClient)(),[{query:T}]=(0,n.useQueryParams)(),v=B()(T,"pageSize",10),D=B()(T,"page",1)*v-v,V={populate:"*",pagination:{start:D,limit:v}},{data:i,refetch:F,status:b}=(0,o.useQuery)(te,()=>e.hi.get(null,V),{onSuccess:()=>{K(d({id:(0,e.OB)("ui.loaded"),defaultMessage:"Data has been loaded"}))},onError:()=>{c({type:"warning",message:{id:(0,e.OB)("ui.error"),defaultMessage:"An error occured"}})}});(0,t.useEffect)(()=>{F()},[D,v]);const Z=(0,o.useMutation)(l=>e.hi.deleteAction(l),{onSuccess:async()=>{await O.invalidateQueries(te),c({type:"success",message:{id:(0,e.OB)("ui.deleted.menu"),defaultMessage:"Menu has been deleted"}})},onError:l=>{l?.response?.data?.data?c({type:"warning",message:l.response.data.data}):c({type:"warning",message:{id:(0,e.OB)("ui.error"),defaultMessage:"An error occured"}})},onSettled:()=>{$()}}),y=async l=>{E();try{await Z.mutateAsync(l)}catch{$()}},g=b!=="success",A=3,C=(i?.data?.length??0)+1,j=i?.meta?.total?Math.ceil(i.meta.total/i.meta.limit):1,G=[{name:"title",key:"title",metadatas:{label:d({id:(0,e.OB)("form.label.title"),defaultMessage:"Title"}),sortable:!0}},{name:"slug",key:"slug",metadatas:{label:d({id:(0,e.OB)("form.label.slug"),defaultMessage:"Slug"}),sortable:!0}},{name:"items",key:"items",metadatas:{label:d({id:(0,e.OB)("form.label.items"),defaultMessage:"Items"}),sortable:!1}}],I=({size:l="L",variant:z="default"})=>t.createElement(ee.z,{onClick:()=>s.push(`/plugins/${e.aw}/create`),startIcon:t.createElement(Le.default,null),variant:z,size:l},d({id:(0,e.OB)("ui.create.menu"),defaultMessage:"Create new menu"}));return t.createElement(f.Ar,{isLoading:g,title:d({id:(0,e.OB)("plugin.name"),defaultMessage:e.oy})},t.createElement(W.T,{title:d({id:(0,e.OB)("plugin.name"),defaultMessage:e.oy}),subtitle:d({id:(0,e.OB)("index.header.subtitle"),defaultMessage:"Customize the structure of menus and menu items"}),primaryAction:t.createElement(I,null)}),t.createElement(P.D,null,t.createElement(_.x,{paddingBottom:10},i?.data?.length?t.createElement(t.Fragment,null,t.createElement(n.DynamicTable,{contentType:"menus",isLoading:g,headers:G,rows:i.data,action:t.createElement(I,{size:"S",variant:"secondary"}),onConfirmDelete:y},t.createElement(f.XS,{data:i.data??[],onClickClone:l=>s.push(`/plugins/${e.aw}/clone/${l}`),onClickEdit:l=>s.push(`/plugins/${e.aw}/edit/${l}`)})),t.createElement(f.eO,{pagination:{pageCount:j}})):t.createElement(n.EmptyStateLayout,{content:{id:(0,e.OB)("index.state.empty"),defaultMessage:"No menus found"},action:t.createElement(I,{size:"S",variant:"secondary"})}))))},$e=(0,t.memo)(xe);var Te=a(185),De=a(89722),Fe=a(37323),be=a(20550);const ze=()=>{(0,n.useFocusWhenNavigate)();const{formatMessage:s}=(0,R.Z)();return t.createElement(Te.o,{labelledBy:"title"},t.createElement(W.T,{id:"title",title:s({id:"content-manager.pageNotFound",defaultMessage:"Page not found"})}),t.createElement(P.D,null,t.createElement(De.x,{action:t.createElement(n.LinkButton,{variant:"secondary",endIcon:t.createElement(Fe.Z,null),to:`/plugins/${e.aw}`},s({id:"app.components.NotFoundPage.back",defaultMessage:"Back to homepage"})),content:s({id:"app.page.not.found",defaultMessage:"Oops! We can't seem to find the page you're looging for..."}),hasRadius:!0,icon:t.createElement(be.Z,{width:"10rem"}),shadow:"tableShadow"})))},Ne=new o.QueryClient({defaultOptions:{queries:{refetchOnWindowFocus:!1}}}),Qe=()=>t.createElement(o.QueryClientProvider,{client:Ne},t.createElement(ae.A,null,t.createElement(p.rs,null,t.createElement(p.AW,{path:`/plugins/${e.aw}`,component:$e,exact:!0}),t.createElement(p.AW,{path:`/plugins/${e.aw}/create`,component:Y,exact:!0}),t.createElement(p.AW,{path:`/plugins/${e.aw}/clone/:id`,component:Y,exact:!0}),t.createElement(p.AW,{path:`/plugins/${e.aw}/edit/:id`,component:Y,exact:!0}),t.createElement(p.AW,{path:"",component:ze}))))},44908:(k,Q,a)=>{var t=a(45652);function p(o){return o&&o.length?t(o):[]}k.exports=p}}]);
