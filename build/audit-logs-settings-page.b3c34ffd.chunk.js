"use strict";(self.webpackChunkmynote=self.webpackChunkmynote||[]).push([[2812],{50935:(Z,f,t)=>{t.d(f,{R:()=>L});var e=t(67281),l=t(80129),M=t(88767);function L(A={},T={}){const{id:c="",...C}=A,v=(0,l.stringify)(C,{encode:!1}),{get:O}=(0,e.useFetchClient)(),{data:g,isError:S,isLoading:D,refetch:U}=(0,M.useQuery)(["users",c,C],async()=>{const{data:{data:b}}=await O(`/admin/users/${c}${v?`?${v}`:""}`);return b},T);let y=[];return c&&g?y=[g]:Array.isArray(g?.results)&&(y=g.results),{users:y,pagination:g?.pagination??null,isLoading:D,isError:S,refetch:U}}},94699:(Z,f,t)=>{t.d(f,{Z:()=>O});var e=t(53547),l=t(41580),M=t(29728),L=t(67281),A=t(89597),T=t(45697),c=t.n(T),C=t(86896);const v=({displayedFilters:g})=>{const[S,D]=(0,e.useState)(!1),{formatMessage:U}=(0,C.Z)(),y=(0,e.useRef)(),b=()=>{D($=>!$)};return e.createElement(e.Fragment,null,e.createElement(l.x,{paddingTop:1,paddingBottom:1},e.createElement(M.z,{variant:"tertiary",ref:y,startIcon:e.createElement(A.Z,null),onClick:b,size:"S"},U({id:"app.utils.filters",defaultMessage:"Filters"})),S&&e.createElement(L.FilterPopoverURLQuery,{displayedFilters:g,isVisible:S,onToggle:b,source:y})),e.createElement(L.FilterListURLQuery,{filtersSchema:g}))};v.propTypes={displayedFilters:c().arrayOf(c().shape({name:c().string.isRequired,metadatas:c().shape({label:c().string}),fieldSchema:c().shape({type:c().string})})).isRequired};const O=v},35915:(Z,f,t)=>{t.r(f),t.d(f,{default:()=>ve});var e=t(53547),l=t(67281),M=t(86706),L=t(99369),A=t(17034),T=t(49066),c=t(41580),C=t(185),v=t(53979),O=t(36989),g=t(86896),S=t(94699),D=t(88767),U=t(16550),y=t(50935);const $=({canReadAuditLogs:a,canReadUsers:d})=>{const{get:u}=(0,l.useFetchClient)(),{search:o}=(0,U.TH)(),m=(0,l.useNotification)(),i={keepPreviousData:!0,retry:!1,staleTime:1e3*20,onError:R=>m({type:"warning",message:R.message})},{users:s,isError:r,isLoading:p}=(0,y.R)({},{...i,enabled:d,staleTime:2*(1e3*60)}),{data:E,isLoading:P,isError:x}=(0,D.useQuery)(["auditLogs",o],async({queryKey:R})=>{const h=R[1],{data:he}=await u(`/admin/audit-logs${h}`);return he},{...i,enabled:a});return{auditLogs:E,users:s,isLoading:p||P,hasError:x||r}};var w=t(42866),k=t(24969),q=t(59946),_=t(63321),ee=t(36773),te=t(45697),n=t.n(te),ae=t(23855);const j=()=>{const{formatDate:a}=(0,g.Z)();return u=>{const o=(0,ae.Z)(u),m=a(o,{dateStyle:"long"}),i=a(o,{timeStyle:"medium",hourCycle:"h24"});return`${m}, ${i}`}};var F=t(11047),se=t(77197),I=t(75515),ne=t(11276),oe=t(64092);const H={"entry.create":"Create entry{model, select, undefined {} other { ({model})}}","entry.update":"Update entry{model, select, undefined {} other { ({model})}}","entry.delete":"Delete entry{model, select, undefined {} other { ({model})}}","entry.publish":"Publish entry{model, select, undefined {} other { ({model})}}","entry.unpublish":"Unpublish entry{model, select, undefined {} other { ({model})}}","media.create":"Create media","media.update":"Update media","media.delete":"Delete media","media-folder.create":"Create media folder","media-folder.update":"Update media folder","media-folder.delete":"Delete media folder","user.create":"Create user","user.update":"Update user","user.delete":"Delete user","admin.auth.success":"Admin login","admin.logout":"Admin logout","content-type.create":"Create content type","content-type.update":"Update content type","content-type.delete":"Delete content type","component.create":"Create component","component.update":"Update component","component.delete":"Delete component","role.create":"Create role","role.update":"Update role","role.delete":"Delete role","permission.create":"Create permission","permission.update":"Update permission","permission.delete":"Delete permission"},N=a=>H[a]||a,z=({actionLabel:a,actionName:d})=>e.createElement(F.k,{direction:"column",alignItems:"baseline",gap:1},e.createElement(I.Z,{textColor:"neutral600",variant:"sigma"},a),e.createElement(I.Z,{textColor:"neutral600"},d));z.propTypes={actionLabel:n().string.isRequired,actionName:n().string.isRequired};const B=z,V=({status:a,data:d,formattedDate:u})=>{const{formatMessage:o}=(0,g.Z)();if(a==="loading")return e.createElement(F.k,{padding:7,justifyContent:"center",alignItems:"center"},e.createElement(se.a,null,"Loading content..."));const{action:m,user:i,payload:s}=d;return e.createElement(e.Fragment,null,e.createElement(c.x,{marginBottom:3},e.createElement(I.Z,{variant:"delta",id:"title"},o({id:"Settings.permissions.auditLogs.details",defaultMessage:"Log Details"}))),e.createElement(ne.r,{gap:4,gridCols:2,paddingTop:4,paddingBottom:4,paddingLeft:6,paddingRight:6,marginBottom:4,background:"neutral100",hasRadius:!0},e.createElement(B,{actionLabel:o({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),actionName:o({id:`Settings.permissions.auditLogs.${m}`,defaultMessage:N(m)},{model:s?.model})}),e.createElement(B,{actionLabel:o({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"}),actionName:u}),e.createElement(B,{actionLabel:o({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),actionName:i?.displayName||"-"}),e.createElement(B,{actionLabel:o({id:"Settings.permissions.auditLogs.userId",defaultMessage:"User ID"}),actionName:i?.id.toString()||"-"})),e.createElement(oe.V,{value:JSON.stringify(s,null,2),disabled:!0,label:o({id:"Settings.permissions.auditLogs.payload",defaultMessage:"Payload"})}))};V.defaultProps={data:{}},V.propTypes={status:n().oneOf(["idle","loading","error","success"]).isRequired,data:n().shape({action:n().string,date:n().string,payload:n().object,user:n().object}),formattedDate:n().string.isRequired};const ie=V,J=({handleClose:a,logId:d})=>{const{get:u}=(0,l.useFetchClient)(),o=(0,l.useNotification)(),m=async E=>{const{data:P}=await u(`/admin/audit-logs/${E}`);if(!P)throw new Error("Audit log not found");return P},{data:i,status:s}=(0,D.useQuery)(["audit-log",d],()=>m(d),{onError(){o({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),a()}}),r=j(),p=i?r(i.date):"";return e.createElement(w.P,{onClose:a,labelledBy:"title"},e.createElement(k.x,null,e.createElement(_.O,{label:p,id:"title"},e.createElement(ee.$,{isCurrent:!0},p))),e.createElement(q.f,null,e.createElement(ie,{status:s,data:i,formattedDate:p})))};J.propTypes={handleClose:n().func.isRequired,logId:n().string.isRequired};const re=J,W=({pagination:a})=>e.createElement(c.x,{paddingTop:4},e.createElement(F.k,{alignItems:"flex-end",justifyContent:"space-between"},e.createElement(l.PageSizeURLQuery,null),e.createElement(l.PaginationURLQuery,{pagination:a})));W.defaultProps={pagination:{pageCount:0,pageSize:50,total:0}},W.propTypes={pagination:n().shape({page:n().number,pageCount:n().number,pageSize:n().number,total:n().number})};const le=W;var de=t(15234),me=t(79031),Y=t(37909),ue=t(12028),ce=t(8934);const K=({headers:a,rows:d,onOpenModal:u})=>{const{formatMessage:o}=(0,g.Z)(),m=j(),i=({type:s,value:r,model:p})=>s==="date"?m(r):s==="action"?o({id:`Settings.permissions.auditLogs.${r}`,defaultMessage:N(r)},{model:p}):r||"-";return e.createElement(de.p,null,d.map(s=>e.createElement(me.Tr,{key:s.id,...(0,l.onRowClick)({fn:()=>u(s.id)})},a.map(({key:r,name:p,cellFormatter:E})=>e.createElement(Y.Td,{key:r},e.createElement(I.Z,{textColor:"neutral800"},i({type:r,value:E?E(s[p]):s[p],model:s.payload?.model})))),e.createElement(Y.Td,{...l.stopPropagation},e.createElement(F.k,{justifyContent:"end"},e.createElement(ue.h,{onClick:()=>u(s.id),"aria-label":o({id:"app.component.table.view",defaultMessage:"{target} details"},{target:`${s.action} action`}),noBorder:!0,icon:e.createElement(ce.Z,null)}))))))};K.defaultProps={rows:[]},K.propTypes={headers:n().array.isRequired,rows:n().array,onOpenModal:n().func.isRequired};const ge=K;var pe=t(29178),fe=t(90608);const Q=({value:a,options:d,onChange:u})=>{const{formatMessage:o}=(0,g.Z)(),m=o({id:"Settings.permissions.auditLogs.filter.aria-label",defaultMessage:"Search and select an option to filter"});return e.createElement(pe.hQ,{"aria-label":m,value:a,onChange:u},d.map(({label:i,customValue:s})=>e.createElement(fe.O,{key:s,value:s},i)))};Q.defaultProps={value:null},Q.propTypes={value:n().string,options:n().arrayOf(n().shape({label:n().string.isRequired,customValue:n().string.isRequired}).isRequired).isRequired,onChange:n().func.isRequired};const G=Q,X=[{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"},value:"$eq"},{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"},value:"$ne"}],ye=({formatMessage:a,users:d,canReadUsers:u})=>{const o=Object.keys(H).map(i=>({label:a({id:`Settings.permissions.auditLogs.${i}`,defaultMessage:N(i)},{model:void 0}),customValue:i})),m=[{name:"action",metadatas:{customOperators:X,label:a({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),options:o,customInput:G},fieldSchema:{type:"enumeration"}},{name:"date",metadatas:{label:a({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"})},fieldSchema:{type:"datetime"}}];if(u&&d){const i=r=>r.username?r.username:r.firstname&&r.lastname?a({id:"Settings.permissions.auditLogs.user.fullname",defaultMessage:"{firstname} {lastname}"},{firstname:r.firstname,lastname:r.lastname}):r.email,s=d.map(r=>({label:i(r),customValue:r.id.toString()}));return[...m,{name:"user",metadatas:{customOperators:X,label:a({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),options:s,customInput:G},fieldSchema:{type:"relation",mainField:{name:"id"}}}]}return m},Ee=[{name:"action",key:"action",metadatas:{label:{id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"},sortable:!0}},{name:"date",key:"date",metadatas:{label:{id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"},sortable:!0}},{key:"user",name:"user",metadatas:{label:{id:"Settings.permissions.auditLogs.user",defaultMessage:"User"},sortable:!1},cellFormatter:a=>a?a.displayName:""}],Le=()=>{const{formatMessage:a}=(0,g.Z)(),d=(0,M.useSelector)(L._),{allowedActions:{canRead:u,canReadUsers:o}}=(0,l.useRBAC)({...d.settings.auditLogs,readUsers:d.settings.users.read}),[{query:m},i]=(0,l.useQueryParams)(),{auditLogs:s,users:r,isLoading:p,hasError:E}=$({canReadAuditLogs:u,canReadUsers:o});(0,l.useFocusWhenNavigate)();const P=ye({formatMessage:a,users:r,canReadUsers:o}),x=a({id:"global.auditLogs",defaultMessage:"Audit Logs"}),R=Ee.map(h=>({...h,metadatas:{...h.metadatas,label:a(h.metadatas.label)}}));return E?e.createElement(A.A,null,e.createElement(T.D,null,e.createElement(c.x,{paddingTop:8},e.createElement(l.AnErrorOccurred,null)))):e.createElement(C.o,{"aria-busy":p},e.createElement(l.SettingsPageTitle,{name:x}),e.createElement(v.T,{title:x,subtitle:a({id:"Settings.permissions.auditLogs.listview.header.subtitle",defaultMessage:"Logs of all the activities that happened in your environment"})}),e.createElement(O.Z,{startActions:e.createElement(S.Z,{displayedFilters:P})}),e.createElement(T.D,{canRead:u},e.createElement(l.DynamicTable,{contentType:"Audit logs",headers:R,rows:s?.results||[],withBulkActions:!0,isLoading:p},e.createElement(ge,{headers:R,rows:s?.results||[],onOpenModal:h=>i({id:h})})),e.createElement(le,{pagination:s?.pagination})),m?.id&&e.createElement(re,{handleClose:()=>i({id:null},"remove"),logId:m.id}))},ve=()=>{const a=(0,M.useSelector)(L._);return e.createElement(l.CheckPagePermissions,{permissions:a.settings.auditLogs.main},e.createElement(Le,null))}},90608:(Z,f,t)=>{t.d(f,{O:()=>l});var e=t(29178);const l=e.Wx}}]);
