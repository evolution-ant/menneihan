(self.webpackChunkmynote=self.webpackChunkmynote||[]).push([[7692],{76539:(D,C,t)=>{"use strict";t.d(C,{Z:()=>A});var e=t(53547),m=t(53979),l=t(11047),o=t(29728),a=t(67281),r=t(85018),p=t(67109),T=t(45697),s=t.n(T),y=t(86896),h=t(30815),n=t(35650);const f=({onRegenerate:M,idToRegenerate:R,backUrl:H,onError:z})=>{const{formatMessage:B}=(0,y.Z)(),[S,F]=(0,e.useState)(!1),{regenerateData:W,isLoadingConfirmation:X}=(0,n.rW)(H,R,M,z),V=async()=>{W(),F(!1)};return e.createElement(e.Fragment,null,e.createElement(o.z,{startIcon:e.createElement(h.Z,null),type:"button",size:"S",variant:"tertiary",onClick:()=>F(!0),name:"regenerate"},B({id:"Settings.tokens.regenerate",defaultMessage:"Regenerate"})),e.createElement(a.ConfirmDialog,{bodyText:{id:"Settings.tokens.popUpWarning.message",defaultMessage:"Are you sure you want to regenerate this token?"},iconRightButton:e.createElement(h.Z,null),isConfirmButtonLoading:X,isOpen:S,onToggleDialog:()=>F(!1),onConfirm:V,leftButtonText:{id:"Settings.tokens.Button.cancel",defaultMessage:"Cancel"},rightButtonText:{id:"Settings.tokens.Button.regenerate",defaultMessage:"Regenerate"},title:{id:"Settings.tokens.RegenerateDialog.title",defaultMessage:"Regenerate token"}}))};f.defaultProps={onRegenerate(){},onError:void 0},f.propTypes={onRegenerate:s().func,idToRegenerate:s().oneOfType([s().number,s().string]).isRequired,backUrl:s().string.isRequired,onError:s().func};const v=f,P=({title:M,token:R,setToken:H,canEditInputs:z,canRegenerate:B,isSubmitting:S,backUrl:F,regenerateUrl:W,onErrorRegenerate:X})=>{const{formatMessage:V}=(0,y.Z)(),w=ee=>{H({...R,accessKey:ee})};return e.createElement(m.T,{title:R?.name||V(M),primaryAction:z?e.createElement(l.k,{gap:2},B&&R?.id&&e.createElement(v,{backUrl:W,onRegenerate:w,idToRegenerate:R?.id,onError:X}),e.createElement(o.z,{disabled:S,loading:S,startIcon:e.createElement(r.default,null),type:"submit",size:"S"},V({id:"global.save",defaultMessage:"Save"}))):B&&R?.id&&e.createElement(v,{onRegenerate:w,idToRegenerate:R?.id,backUrl:W}),navigationAction:e.createElement(a.Link,{startIcon:e.createElement(p.Z,null),to:F},V({id:"global.back",defaultMessage:"Back"})),ellipsis:!0})};P.propTypes={token:s().shape({id:s().oneOfType([s().number,s().string]),type:s().string,lifespan:s().oneOfType([s().number,s().string]),name:s().string,accessKey:s().string,permissions:s().array,description:s().string,createdAt:s().string}),canEditInputs:s().bool.isRequired,canRegenerate:s().bool.isRequired,setToken:s().func.isRequired,isSubmitting:s().bool.isRequired,backUrl:s().string.isRequired,title:s().shape({id:s().string,label:s().string}).isRequired,regenerateUrl:s().string.isRequired,onErrorRegenerate:s().func},P.defaultProps={token:void 0,onErrorRegenerate:void 0};const A=P},60401:(D,C,t)=>{"use strict";t.d(C,{Z:()=>y});var e=t(53547),m=t(40619),l=t(82562),o=t(75515),a=t(45697),r=t.n(a),p=t(86896),T=t(75056);const s=({token:h,errors:n,values:f,onChange:v,isCreating:P})=>{const{formatMessage:A}=(0,p.Z)();return e.createElement(e.Fragment,null,e.createElement(m.P,{name:"lifespan",label:A({id:"Settings.tokens.form.duration",defaultMessage:"Token duration"}),value:f.lifespan!==null?f.lifespan:"0",error:n.lifespan?A(n.lifespan?.id?n.lifespan:{id:n.lifespan,defaultMessage:n.lifespan}):null,onChange:M=>{v({target:{name:"lifespan",value:M}})},required:!0,disabled:!P,placeholder:"Select"},e.createElement(l.W,{value:"604800000"},A({id:"Settings.tokens.duration.7-days",defaultMessage:"7 days"})),e.createElement(l.W,{value:"2592000000"},A({id:"Settings.tokens.duration.30-days",defaultMessage:"30 days"})),e.createElement(l.W,{value:"7776000000"},A({id:"Settings.tokens.duration.90-days",defaultMessage:"90 days"})),e.createElement(l.W,{value:"0"},A({id:"Settings.tokens.duration.unlimited",defaultMessage:"Unlimited"}))),e.createElement(o.Z,{variant:"pi",textColor:"neutral600"},!P&&`${A({id:"Settings.tokens.duration.expiration-date",defaultMessage:"Expiration date"})}: ${(0,T.IX)(h?.createdAt,parseInt(f.lifespan,10))}`))};s.propTypes={errors:r().shape({lifespan:r().string}),onChange:r().func.isRequired,values:r().shape({lifespan:r().oneOfType([r().number,r().string])}).isRequired,isCreating:r().bool.isRequired,token:r().shape({id:r().oneOfType([r().number,r().string]),type:r().string,lifespan:r().string,name:r().string,accessKey:r().string,permissions:r().array,description:r().string,createdAt:r().string})},s.defaultProps={errors:{},token:{}};const y=s},24122:(D,C,t)=>{"use strict";t.d(C,{Z:()=>y});var e=t(53547),m=t(12028),l=t(67281),o=t(65186),a=t(69427),r=t(45697),p=t.n(r),T=t(86896);const s=({token:h,tokenType:n})=>{const{formatMessage:f}=(0,T.Z)(),v=(0,l.useNotification)(),{trackUsage:P}=(0,l.useTracking)(),{copy:A}=(0,l.useClipboard)(),M=R=>async()=>{await A(R)&&(P.current("didCopyTokenKey",{tokenType:n}),v({type:"success",message:{id:"Settings.tokens.notification.copied"}}))};return e.createElement(l.ContentBox,{endAction:h&&e.createElement("span",{style:{alignSelf:"start"}},e.createElement(m.h,{label:f({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),onClick:M(h),noBorder:!0,icon:e.createElement(o.Z,null),style:{padding:0,height:"1rem"}})),title:h||f({id:"Settings.tokens.copy.editTitle",defaultMessage:"This token isn\u2019t accessible anymore."}),subtitle:f(h?{id:"Settings.tokens.copy.lastWarning",defaultMessage:"Make sure to copy this token, you won\u2019t be able to see it again!"}:{id:"Settings.tokens.copy.editMessage",defaultMessage:"For security reasons, you can only see your token once."}),icon:e.createElement(a.Z,null),iconBackground:"neutral100"})};s.defaultProps={token:null},s.propTypes={token:p().string,tokenType:p().string.isRequired};const y=s},40695:(D,C,t)=>{"use strict";t.d(C,{Z:()=>p});var e=t(53547),m=t(61467),l=t(45697),o=t.n(l),a=t(86896);const r=({errors:T,values:s,onChange:y,canEditInputs:h})=>{const{formatMessage:n}=(0,a.Z)();return e.createElement(m.g,{label:n({id:"Settings.tokens.form.description",defaultMessage:"Description"}),id:"description",error:T.description?n(T.description?.id?T.description:{id:T.description,defaultMessage:T.description}):null,onChange:y,disabled:!h},s.description)};r.propTypes={errors:o().shape({description:o().string}),onChange:o().func.isRequired,canEditInputs:o().bool.isRequired,values:o().shape({description:o().string}).isRequired},r.defaultProps={errors:{}};const p=r},61053:(D,C,t)=>{"use strict";t.d(C,{Z:()=>p});var e=t(53547),m=t(16364),l=t(45697),o=t.n(l),a=t(86896);const r=({errors:T,values:s,onChange:y,canEditInputs:h})=>{const{formatMessage:n}=(0,a.Z)();return e.createElement(m.o,{name:"name",error:T.name?n(T.name?.id?T.name:{id:T.name,defaultMessage:T.name}):null,label:n({id:"Settings.tokens.form.name",defaultMessage:"Name"}),onChange:y,value:s.name,disabled:!h,required:!0})};r.propTypes={errors:o().shape({name:o().string}),onChange:o().func.isRequired,canEditInputs:o().bool.isRequired,values:o().shape({name:o().string}).isRequired},r.defaultProps={errors:{}};const p=r},31065:(D,C,t)=>{"use strict";t.d(C,{Z:()=>T});var e=t(53547),m=t(40619),l=t(82562),o=t(45697),a=t.n(o),r=t(86896);const p=({name:s,errors:y,values:h,onChange:n,canEditInputs:f,options:v,label:P})=>{const{formatMessage:A}=(0,r.Z)();return e.createElement(m.P,{name:s,label:A({id:P.id,defaultMessage:P.defaultMessage}),value:h&&h[s],error:y[s]?A(y[s]?.id?y[s]:{id:y[s],defaultMessage:y[s]}):null,onChange:n,placeholder:"Select",required:!0,disabled:!f},v&&v.map(({value:M,label:R})=>e.createElement(l.W,{key:M,value:M},A(R))))};p.propTypes={name:a().string,options:a().arrayOf(a().shape({label:a().shape({id:a().string,defaultMessage:a().string}),value:a().string})),errors:a().shape({type:a().string}),onChange:a().func.isRequired,canEditInputs:a().bool.isRequired,values:a().shape({type:a().string}).isRequired,label:a().shape({id:a().string,defaultMessage:a().string}).isRequired},p.defaultProps={name:"type",errors:{},options:[]};const T=p},47670:(D,C,t)=>{"use strict";t.d(C,{Z:()=>e,f:()=>m});const e="api-token",m="transfer-token"},57692:(D,C,t)=>{"use strict";t.d(C,{Z:()=>Xe});var e=t(53547),m=t(185),l=t(49066),o=t(11047),a=t(67281),r=t(94649),p=t(86896),T=t(88767),s=t(86706),y=t(16550),h=t(45697),n=t.n(h);const f=(0,e.createContext)({}),v=({children:i,...c})=>e.createElement(f.Provider,{value:c},i),P=()=>(0,e.useContext)(f);v.propTypes={children:n().node.isRequired};var A=t(19631),M=t(99369),R=t(47670),H=t(76539),z=t(24122),B=t(41580),S=t(75515),F=t(11276),W=t(67819),X=t(60401),V=t(40695),w=t(61053),ee=t(31065);const te=({errors:i,onChange:c,canEditInputs:d,isCreating:O,values:g,apiToken:I,onDispatch:E,setHasChangedPermissions:$})=>{const{formatMessage:N}=(0,p.Z)(),K=({target:{value:b}})=>{$(!1),b==="full-access"&&E({type:"SELECT_ALL_ACTIONS"}),b==="read-only"&&E({type:"ON_CHANGE_READ_ONLY"})},Y=[{value:"read-only",label:{id:"Settings.tokens.types.read-only",defaultMessage:"Read-only"}},{value:"full-access",label:{id:"Settings.tokens.types.full-access",defaultMessage:"Full access"}},{value:"custom",label:{id:"Settings.tokens.types.custom",defaultMessage:"Custom"}}];return e.createElement(B.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(o.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(S.Z,{variant:"delta",as:"h2"},N({id:"global.details",defaultMessage:"Details"})),e.createElement(F.r,{gap:5},e.createElement(W.P,{key:"name",col:6,xs:12},e.createElement(w.Z,{errors:i,values:g,canEditInputs:d,onChange:c})),e.createElement(W.P,{key:"description",col:6,xs:12},e.createElement(V.Z,{errors:i,values:g,canEditInputs:d,onChange:c})),e.createElement(W.P,{key:"lifespan",col:6,xs:12},e.createElement(X.Z,{isCreating:O,errors:i,values:g,onChange:c,token:I})),e.createElement(W.P,{key:"type",col:6,xs:12},e.createElement(ee.Z,{values:g,errors:i,label:{id:"Settings.tokens.form.type",defaultMessage:"Token type"},onChange:b=>{K({target:{value:b}}),c({target:{name:"type",value:b}})},options:Y,canEditInputs:d})))))};te.propTypes={errors:n().shape({name:n().string,description:n().string,lifespan:n().string,type:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({name:n().string,description:n().string,lifespan:n().oneOfType([n().number,n().string]),type:n().string}).isRequired,isCreating:n().bool.isRequired,apiToken:n().shape({id:n().oneOfType([n().number,n().string]),type:n().string,lifespan:n().string,name:n().string,accessKey:n().string,permissions:n().array,description:n().string,createdAt:n().string}),onDispatch:n().func.isRequired,setHasChangedPermissions:n().func.isRequired},te.defaultProps={errors:{},apiToken:{}};const Ee=te;var fe=t(53979),ye=t(29728),Te=t(85018);const ne=({apiTokenName:i})=>{const{formatMessage:c}=(0,p.Z)();return(0,a.useFocusWhenNavigate)(),e.createElement(m.o,{"aria-busy":"true"},e.createElement(a.SettingsPageTitle,{name:"API Tokens"}),e.createElement(fe.T,{primaryAction:e.createElement(ye.z,{disabled:!0,startIcon:e.createElement(Te.default,null),type:"button",size:"L"},c({id:"global.save",defaultMessage:"Save"})),title:i||c({id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"})}),e.createElement(l.D,null,e.createElement(a.LoadingIndicatorPage,null)))};ne.defaultProps={apiTokenName:null},ne.propTypes={apiTokenName:n().string};const he=ne;var Ae=t(35161),ve=t.n(Ae),Ce=t(13217),Pe=t.n(Ce),_=t(54863);const Me=i=>{switch(i){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},Re=(0,_.default)(B.x)`
  margin: -1px;
  border-radius: ${({theme:i})=>i.spaces[1]} 0 0 ${({theme:i})=>i.spaces[1]};
`;function se({route:i}){const{formatMessage:c}=(0,p.Z)(),{method:d,handler:O,path:g}=i,I=g?Pe()(g.split("/")):[],[E="",$=""]=O?O.split("."):[],N=Me(i.method);return e.createElement(o.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(S.Z,{variant:"delta",as:"h3"},c({id:"Settings.apiTokens.createPage.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",e.createElement("span",null,E),e.createElement(S.Z,{variant:"delta",textColor:"primary600"},".",$)),e.createElement(o.k,{hasRadius:!0,background:"neutral0",borderColor:"neutral200",gap:0},e.createElement(Re,{background:N.background,borderColor:N.border,padding:2},e.createElement(S.Z,{fontWeight:"bold",textColor:N.text},d)),e.createElement(B.x,{paddingLeft:2,paddingRight:2},ve()(I,K=>e.createElement(S.Z,{key:K,textColor:K.includes(":")?"neutral600":"neutral900"},"/",K)))))}se.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},se.propTypes={route:n().shape({handler:n().string,method:n().string,path:n().string})};const Oe=se,De=()=>{const{value:{selectedAction:i,routes:c}}=P(),{formatMessage:d}=(0,p.Z)(),O=i?.split(".")[0];return e.createElement(W.P,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"}},i?e.createElement(o.k,{direction:"column",alignItems:"stretch",gap:2},c[O]?.map(g=>g.config.auth?.scope?.includes(i)||g.handler===i?e.createElement(Oe,{key:g.handler,route:g}):null)):e.createElement(o.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(S.Z,{variant:"delta",as:"h3"},d({id:"Settings.apiTokens.createPage.permissions.header.title",defaultMessage:"Advanced settings"})),e.createElement(S.Z,{as:"p",textColor:"neutral600"},d({id:"Settings.apiTokens.createPage.permissions.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"}))))};var Ie=t(48734),ke=t(74756),Se=t(63081),ue=t(36213),xe=t(78114),Le=t(48403),Be=t.n(Le);const ge=(0,_.css)`
  background: ${i=>i.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`,Ue=(0,_.default)(B.x)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${i=>i.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${i=>i.isActive&&ge}
  &:hover {
    ${ge}
  }
`,We=_.default.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:i})=>i.colors.neutral150};
`,ae=({controllers:i,label:c,orderNumber:d,disabled:O,onExpanded:g,indexExpandendCollapsedContent:I})=>{const{value:{onChangeSelectAll:E,onChange:$,selectedActions:N,setSelectedAction:K,selectedAction:Y}}=P(),[b,q]=(0,e.useState)(!1),{formatMessage:re}=(0,p.Z)(),j=()=>{q(k=>!k),g(d)};(0,e.useEffect)(()=>{I!==null&&I!==d&&b&&q(!1)},[I,d,b]);const L=k=>k===Y;return e.createElement(Ie.U,{expanded:b,onToggle:j,variant:d%2?"primary":"secondary"},e.createElement(ke.B,{title:Be()(c)}),e.createElement(Se.v,null,i?.map(k=>{const Q=k.actions.every(U=>N.includes(U.actionId)),le=k.actions.some(U=>N.includes(U.actionId));return e.createElement(B.x,{key:`${c}.${k?.controller}`},e.createElement(o.k,{justifyContent:"space-between",alignItems:"center",padding:4},e.createElement(B.x,{paddingRight:4},e.createElement(S.Z,{variant:"sigma",textColor:"neutral600"},k?.controller)),e.createElement(We,null),e.createElement(B.x,{paddingLeft:4},e.createElement(ue.X,{value:Q,indeterminate:!Q&&le,onValueChange:()=>{E({target:{value:[...k.actions]}})},disabled:O},re({id:"app.utils.select-all",defaultMessage:"Select all"})))),e.createElement(F.r,{gap:4,padding:4},k?.actions&&k?.actions.map(U=>e.createElement(W.P,{col:6,key:U.actionId},e.createElement(Ue,{isActive:L(U.actionId),padding:2,hasRadius:!0},e.createElement(ue.X,{value:N.includes(U.actionId),name:U.actionId,onValueChange:()=>{$({target:{value:U.actionId}})},disabled:O},U.action),e.createElement("button",{type:"button","data-testid":"action-cog",onClick:()=>K({target:{value:U.actionId}}),style:{display:"inline-flex",alignItems:"center"}},e.createElement(xe.Z,null)))))))})))};ae.defaultProps={controllers:[],orderNumber:0,disabled:!1,onExpanded:()=>null,indexExpandendCollapsedContent:null},ae.propTypes={controllers:n().array,orderNumber:n().number,label:n().string.isRequired,disabled:n().bool,onExpanded:n().func,indexExpandendCollapsedContent:n().number};const Ze=ae,oe=({section:i,...c})=>{const[d,O]=(0,e.useState)(null),g=I=>O(I);return e.createElement(B.x,{padding:4,background:"neutral0"},i&&i.map((I,E)=>e.createElement(Ze,{key:I.apiId,label:I.label,controllers:I.controllers,orderNumber:E,indexExpandendCollapsedContent:d,onExpanded:g,name:I.apiId,...c})))};oe.defaultProps={section:null},oe.propTypes={section:n().arrayOf(n().object)};const Ne=oe,Ke=({...i})=>{const{value:{data:c}}=P(),{formatMessage:d}=(0,p.Z)();return e.createElement(F.r,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0"},e.createElement(W.P,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(o.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(S.Z,{variant:"delta",as:"h2"},d({id:"Settings.apiTokens.createPage.permissions.title",defaultMessage:"Permissions"})),e.createElement(S.Z,{as:"p",textColor:"neutral600"},d({id:"Settings.apiTokens.createPage.permissions.description",defaultMessage:"Only actions bound by a route are listed below."}))),c?.permissions&&e.createElement(Ne,{section:c?.permissions,...i})),e.createElement(De,null))},be=(0,e.memo)(Ke);var ie=t(75056);const Fe=(i,c=[])=>({...i,selectedAction:null,routes:[],selectedActions:[],data:(0,ie.mk)(c)});var $e=t(18172),He=t(97019),me=t.n(He);const Ve={data:{},selectedActions:[]},Ge=(i,c)=>(0,$e.default)(i,d=>{switch(c.type){case"ON_CHANGE":{d.selectedActions.includes(c.value)?me()(d.selectedActions,c.value):d.selectedActions.push(c.value);break}case"SELECT_ALL_IN_PERMISSION":{c.value.every(g=>d.selectedActions.includes(g.actionId))?c.value.forEach(g=>{me()(d.selectedActions,g.actionId)}):c.value.forEach(g=>{d.selectedActions.push(g.actionId)});break}case"SELECT_ALL_ACTIONS":{d.selectedActions=[...d.data.allActionsIds];break}case"ON_CHANGE_READ_ONLY":{const O=d.data.allActionsIds.filter(g=>g.includes("find")||g.includes("findOne"));d.selectedActions=[...O];break}case"UPDATE_PERMISSIONS_LAYOUT":{d.data=(0,ie.mk)(c.value);break}case"UPDATE_ROUTES":{d.routes={...c.value};break}case"UPDATE_PERMISSIONS":{d.selectedActions=[...c.value];break}case"SET_SELECTED_ACTION":{d.selectedAction=c.value;break}default:return d}}),ze="Name already taken",Xe=()=>{(0,a.useFocusWhenNavigate)();const{formatMessage:i}=(0,p.Z)(),{lockApp:c,unlockApp:d}=(0,a.useOverlayBlocker)(),O=(0,a.useNotification)(),g=(0,y.k6)(),I=(0,s.useSelector)(M._),[E,$]=(0,e.useState)(g.location.state?.apiToken.accessKey?{...g.location.state.apiToken}:null),{trackUsage:N}=(0,a.useTracking)(),K=(0,e.useRef)(N),{setCurrentStep:Y}=(0,a.useGuidedTour)(),{allowedActions:{canCreate:b,canUpdate:q,canRegenerate:re}}=(0,a.useRBAC)(I.settings["api-tokens"]),[j,L]=(0,e.useReducer)(Ge,Ve,u=>Fe(u,{})),{params:{id:k}}=(0,y.$B)("/settings/api-tokens/:id"),{get:Q,post:le,put:U}=(0,a.useFetchClient)(),Z=k==="create";(0,T.useQuery)("content-api-permissions",async()=>{const[u,G]=await Promise.all(["/admin/content-api/permissions","/admin/content-api/routes"].map(async J=>{const{data:x}=await Q(J);return x.data}));L({type:"UPDATE_PERMISSIONS_LAYOUT",value:u}),L({type:"UPDATE_ROUTES",value:G}),E&&(E?.type==="read-only"&&L({type:"ON_CHANGE_READ_ONLY"}),E?.type==="full-access"&&L({type:"SELECT_ALL_ACTIONS"}),E?.type==="custom"&&L({type:"UPDATE_PERMISSIONS",value:E?.permissions}))},{onError(){O({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),(0,e.useEffect)(()=>{K.current(Z?"didAddTokenFromList":"didEditTokenFromList",{tokenType:R.Z})},[Z]);const{status:Ye}=(0,T.useQuery)(["api-token",k],async()=>{const{data:{data:u}}=await Q(`/admin/api-tokens/${k}`);return $({...u}),u?.type==="read-only"&&L({type:"ON_CHANGE_READ_ONLY"}),u?.type==="full-access"&&L({type:"SELECT_ALL_ACTIONS"}),u?.type==="custom"&&L({type:"UPDATE_PERMISSIONS",value:u?.permissions}),u},{enabled:!Z&&!E,onError(){O({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),je=async(u,G)=>{K.current(Z?"willCreateToken":"willEditToken",{tokenType:R.Z}),c();const J=u.lifespan&&parseInt(u.lifespan,10)&&u.lifespan!=="0"?parseInt(u.lifespan,10):null;try{const{data:{data:x}}=Z?await le("/admin/api-tokens",{...u,lifespan:J,permissions:u.type==="custom"?j.selectedActions:null}):await U(`/admin/api-tokens/${k}`,{name:u.name,description:u.description,type:u.type,permissions:u.type==="custom"?j.selectedActions:null});Z&&(g.replace(`/settings/api-tokens/${x.id}`,{apiToken:x}),Y("apiTokens.success")),d(),$({...x}),O({type:"success",message:i(Z?{id:"notification.success.apitokencreated",defaultMessage:"API Token successfully created"}:{id:"notification.success.apitokenedited",defaultMessage:"API Token successfully edited"})}),K.current(Z?"didCreateToken":"didEditToken",{type:E.type,tokenType:R.Z})}catch(x){const pe=(0,A.Iz)(x.response.data);G.setErrors(pe),x?.response?.data?.error?.message===ze?O({type:"warning",message:x.response.data.message||"notification.error.tokennamenotunique"}):O({type:"warning",message:x?.response?.data?.message||"notification.error"}),d()}},[Qe,ce]=(0,e.useState)(!1),Je={...j,onChange:({target:{value:u}})=>{ce(!0),L({type:"ON_CHANGE",value:u})},onChangeSelectAll:({target:{value:u}})=>{ce(!0),L({type:"SELECT_ALL_IN_PERMISSION",value:u})},setSelectedAction:({target:{value:u}})=>{L({type:"SET_SELECTED_ACTION",value:u})}},de=q&&!Z||b&&Z;return!Z&&!E&&Ye!=="success"?e.createElement(he,{apiTokenName:E?.name}):e.createElement(v,{value:Je},e.createElement(m.o,null,e.createElement(a.SettingsPageTitle,{name:"API Tokens"}),e.createElement(r.Formik,{validationSchema:ie.fK,validateOnChange:!1,initialValues:{name:E?.name||"",description:E?.description||"",type:E?.type,lifespan:E?.lifespan?E.lifespan.toString():E?.lifespan},enableReinitialize:!0,onSubmit:(u,G)=>je(u,G)},({errors:u,handleChange:G,isSubmitting:J,values:x,setFieldValue:pe})=>(Qe&&x?.type!=="custom"&&pe("type","custom"),e.createElement(a.Form,null,e.createElement(H.Z,{backUrl:"/settings/api-tokens",title:{id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"},token:E,setToken:$,canEditInputs:de,canRegenerate:re,isSubmitting:J,regenerateUrl:"/admin/api-tokens/"}),e.createElement(l.D,null,e.createElement(o.k,{direction:"column",alignItems:"stretch",gap:6},Boolean(E?.name)&&e.createElement(z.Z,{token:E?.accessKey,tokenType:R.Z}),e.createElement(Ee,{errors:u,onChange:G,canEditInputs:de,isCreating:Z,values:x,apiToken:E,onDispatch:L,setHasChangedPermissions:ce}),e.createElement(be,{disabled:!de||x?.type==="read-only"||x?.type==="full-access"}))))))))}},75056:(D,C,t)=>{"use strict";t.d(C,{IX:()=>a,fK:()=>s,mk:()=>h});var e=t(66115),m=t(77349),l=t(51991);const a=(n,f,v="en")=>{if(f&&typeof f=="number"){const P=f/24/60/60/1e3;return(0,e.Z)((0,m.Z)(new Date(n),P),"PPP",{locale:l[v]})}return"Unlimited"};var r=t(67281),p=t(87561);const s=p.object().shape({name:p.string(r.translatedErrors.string).max(100).required(r.translatedErrors.required),type:p.string(r.translatedErrors.string).oneOf(["read-only","full-access","custom"]).required(r.translatedErrors.required),description:p.string().nullable(),lifespan:p.number().integer().min(0).nullable().defined(r.translatedErrors.required)}),h=n=>{const f={allActionsIds:[],permissions:[]};return f.permissions=Object.keys(n).map(v=>({apiId:v,label:v.split("::")[1],controllers:Object.keys(n[v].controllers).map(P=>({controller:P,actions:n[v].controllers[P].map(A=>{const M=`${v}.${P}.${A}`;return v.includes("api::")&&f.allActionsIds.push(M),{action:A,actionId:M}}).flat()})).flat()})),f}},74221:D=>{function C(t,e,m,l){for(var o=m-1,a=t.length;++o<a;)if(l(t[o],e))return o;return-1}D.exports=C},65464:(D,C,t)=>{var e=t(29932),m=t(42118),l=t(74221),o=t(7518),a=t(278),r=Array.prototype,p=r.splice;function T(s,y,h,n){var f=n?l:m,v=-1,P=y.length,A=s;for(s===y&&(y=a(y)),h&&(A=e(s,o(h)));++v<P;)for(var M=0,R=y[v],H=h?h(R):R;(M=f(A,H,M,n))>-1;)A!==s&&p.call(A,M,1),p.call(s,M,1);return s}D.exports=T},97019:(D,C,t)=>{var e=t(5976),m=t(45604),l=e(m);D.exports=l},45604:(D,C,t)=>{var e=t(65464);function m(l,o){return l&&l.length&&o&&o.length?e(l,o):l}D.exports=m},13217:(D,C,t)=>{var e=t(14259);function m(l){var o=l==null?0:l.length;return o?e(l,1,o):[]}D.exports=m}}]);
