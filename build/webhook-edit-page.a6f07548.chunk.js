"use strict";(self.webpackChunkmynote=self.webpackChunkmynote||[]).push([[5162],{93016:(X,f,t)=>{t.d(f,{Z:()=>p});var e=t(53547),g=t(84714);function m(){return e.createElement(g.Z.Root,null,e.createElement(g.Z.Headers,null),e.createElement(g.Z.Body,null))}const p=m},84714:(X,f,t)=>{t.d(f,{Z:()=>Ee});var e=t(53547),g=t(45421),m=t(11047),p=t(64777),k=t(77197),H=t(65833),L=t(33709),S=t(54580),h=t(63237),Y=t(75515),ce=t(26031),N=t(36213),_=t(92155),I=t(94649),q=t(45697),P=t.n(q),G=t(86896),ue=t(54863),D=t(39645);const ge=o=>o.reduce((i,l)=>{const C=l.split(".")[0];return i[C]||(i[C]=[]),i[C].push(l),i},{}),E=(0,ue.default)(g.w)`
  tbody tr:nth-child(odd) {
    background: ${({theme:o})=>o.colors.neutral100};
  }

  thead th span {
    color: ${({theme:o})=>o.colors.neutral500};
  }

  td,
  th {
    padding-block-start: ${({theme:o})=>o.spaces[3]};
    padding-block-end: ${({theme:o})=>o.spaces[3]};
    width: 10%;
    vertical-align: middle;
    text-align: center;
  }

  tbody tr td:first-child {
    /**
     * Add padding to the start of the first column to avoid the checkbox appearing
     * too close to the edge of the table
     */
    padding-inline-start: ${({theme:o})=>o.spaces[2]};
  }
`,W=o=>{const i=[{id:"Settings.webhooks.events.create",defaultMessage:"Create"},{id:"Settings.webhooks.events.update",defaultMessage:"Update"},{id:"app.utils.delete",defaultMessage:"Delete"}];return o&&(i.push({id:"app.utils.publish",defaultMessage:"Publish"}),i.push({id:"app.utils.unpublish",defaultMessage:"Unpublish"})),i},me=o=>{const i=["entry.create","entry.update","entry.delete"];return o&&i.push("entry.publish","entry.unpublish"),{entry:i,media:["media.create","media.update","media.delete"]}},ee=e.createContext(),oe=({children:o})=>{const{formatMessage:i}=(0,G.Z)(),{collectionTypes:l,isLoading:C}=(0,D.G)(),y=e.useMemo(()=>l.some(O=>O.options.draftAndPublish===!0),[l]),B=i({id:"Settings.webhooks.form.events",defaultMessage:"Events"});return e.createElement(ee.Provider,{value:{isDraftAndPublish:y}},e.createElement(m.k,{direction:"column",alignItems:"stretch",gap:1},e.createElement(p.Q,{"aria-hidden":!0},B),C&&e.createElement(k.a,null,i({id:"Settings.webhooks.events.isLoading",defaultMessage:"Events loading"})),e.createElement(E,{"aria-label":B},o)))};oe.propTypes={children:P().oneOfType([P().arrayOf(P().node),P().node]).isRequired};const te=({getHeaders:o=W})=>{const{isDraftAndPublish:i}=e.useContext(ee),{formatMessage:l}=(0,G.Z)(),C=o(i);return e.createElement(H.S,null,e.createElement(L.Z,null,e.createElement(S.g,null,e.createElement(h.T,null,l({id:"Settings.webhooks.event.select",defaultMessage:"Select event"}))),C.map(y=>["app.utils.publish","app.utils.unpublish"].includes(y.id)?e.createElement(S.g,{key:y.id,title:l({id:"Settings.webhooks.event.publish-tooltip",defaultMessage:"This event only exists for content with draft & publish enabled"})},e.createElement(Y.Z,{variant:"sigma",textColor:"neutral600"},l(y))):e.createElement(S.g,{key:y.id},e.createElement(Y.Z,{variant:"sigma",textColor:"neutral600"},l(y))))))};te.defaultProps={getHeaders:W},te.propTypes={getHeaders:P().func};const ne=({providedEvents:o})=>{const{isDraftAndPublish:i}=e.useContext(ee),l=o||me(i),{values:C,handleChange:y}=(0,I.useFormikContext)(),B="events",O=C.events,K=[],V=ge(O),w=({target:{name:b,value:d}})=>{let A=new Set(O);d?A.add(b):A.delete(b),y({target:{name:B,value:Array.from(A)}})},j=({target:{name:b,value:d}})=>{let A=new Set(O);d?l[b].forEach(Q=>{K.includes(Q)||A.add(Q)}):l[b].forEach(Q=>A.delete(Q)),y({target:{name:B,value:Array.from(A)}})};return e.createElement(ce.X,null,Object.entries(l).map(([b,d])=>e.createElement(x,{disabledEvents:K,key:b,name:b,events:d,inputValue:V[b],handleSelect:w,handleSelectAll:j})))};ne.defaultProps={providedEvents:null},ne.propTypes={providedEvents:P().object};const le=o=>o.replace(/-/g," ").split(" ").map(i=>i.charAt(0).toUpperCase()+i.slice(1).toLowerCase()).join(" "),x=({disabledEvents:o,name:i,events:l,inputValue:C,handleSelect:y,handleSelectAll:B})=>{const{formatMessage:O}=(0,G.Z)(),K=l.filter(d=>!o.includes(d)),V=C.length>0,w=C.length===K.length,j=({target:{name:d}})=>{B({target:{name:d,value:!w}})},b=5;return e.createElement(L.Z,null,e.createElement(S.f,null,e.createElement(N.X,{indeterminate:V&&!w,"aria-label":O({id:"global.select-all-entries",defaultMessage:"Select all entries"}),name:i,onChange:j,value:w},le(i))),l.map(d=>e.createElement(S.f,{key:d},e.createElement(_.C,{disabled:o.includes(d),"aria-label":d,name:d,value:C.includes(d),onValueChange:A=>y({target:{name:d,value:A}})}))),l.length<b&&e.createElement(S.f,{colSpan:`${b-l.length}`}))};x.defaultProps={disabledEvents:[],events:[],inputValue:[],handleSelect(){},handleSelectAll(){}},x.propTypes={disabledEvents:P().array,events:P().array,inputValue:P().array,handleSelect:P().func,handleSelectAll:P().func,name:P().string.isRequired};const Ee={Root:oe,Headers:te,Body:ne,EventRow:x}},41128:(X,f,t)=>{t.d(f,{Z:()=>Pe});var e=t(53547),g=t(185),m=t(67281),p=t(88767),k=t(16550),H=t(39645),L=t(70885),S=t(53979),h=t(11047),Y=t(29728),ce=t(49066),N=t(41580),_=t(11276),I=t(67819),q=t(16364),P=t(90321),G=t(85018),ue=t(67109),D=t(94649),ge=t(45697),E=t.n(ge),W=t(86896),me=t(64777),ee=t(39785),oe=t(96315),te=t(29178),ne=t(90608);const le=["A-IM","Accept","Accept-Charset","Accept-Encoding","Accept-Language","Accept-Datetime","Access-Control-Request-Method","Access-Control-Request-Headers","Authorization","Cache-Control","Connection","Content-Length","Content-Type","Cookie","Date","Expect","Forwarded","From","Host","If-Match","If-Modified-Since","If-None-Match","If-Range","If-Unmodified-Since","Max-Forwards","Origin","Pragma","Proxy-Authorization","Range","Referer","TE","User-Agent","Upgrade","Via","Warning"],x=({name:n,onChange:a,value:s,...c})=>{const{values:{headers:v}}=(0,D.useFormikContext)(),[Z,u]=(0,e.useState)(le);(0,e.useEffect)(()=>{u(le.filter(r=>!v?.some($=>$.key!==s&&$.key===r)))},[v,s]);const F=r=>{a({target:{name:n,value:r}})},ae=r=>{u($=>[...$,r]),F(r)};return e.createElement(te.XU,{...c,onClear:()=>F(""),onChange:F,onCreateOption:ae,placeholder:"",value:s},Z.map(r=>e.createElement(ne.O,{value:r,key:r},r)))};x.defaultProps={value:void 0},x.propTypes={name:E().string.isRequired,onChange:E().func.isRequired,value:E().string};const Ee=x,i=()=>{const{formatMessage:n}=(0,W.Z)(),{values:a,errors:s}=(0,D.useFormikContext)();return e.createElement(h.k,{direction:"column",alignItems:"stretch",gap:1},e.createElement(me.Q,null,n({id:"Settings.webhooks.form.headers",defaultMessage:"Headers"})),e.createElement(N.x,{padding:8,background:"neutral100",hasRadius:!0},e.createElement(D.FieldArray,{validateOnChange:!1,name:"headers",render:({push:c,remove:v})=>e.createElement(_.r,{gap:4},a.headers.map((Z,u)=>e.createElement(e.Fragment,{key:`${u}.${Z.key}`},e.createElement(I.P,{col:6},e.createElement(D.Field,{as:Ee,name:`headers.${u}.key`,"aria-label":`row ${u+1} key`,label:n({id:"Settings.webhooks.key",defaultMessage:"Key"}),error:s.headers?.[u]?.key&&s.headers[u].key})),e.createElement(I.P,{col:6},e.createElement(h.k,{alignItems:"flex-end"},e.createElement(N.x,{style:{flex:1}},e.createElement(D.Field,{as:q.o,name:`headers.${u}.value`,"aria-label":`row ${u+1} value`,label:n({id:"Settings.webhooks.value",defaultMessage:"Value"}),error:s.headers?.[u]?.value&&s.headers[u].value})),e.createElement(h.k,{paddingLeft:2,style:{alignSelf:"center"},paddingTop:s.headers?.[u]?.value?0:5},e.createElement(m.RemoveRoundedButton,{disabled:a.headers.length===1,onClick:()=>v(u),label:n({id:"Settings.webhooks.headers.remove",defaultMessage:"Remove header row {number}"},{number:u+1})})))))),e.createElement(I.P,{col:12},e.createElement(ee.A,{type:"button",onClick:()=>{c({key:"",value:""})},startIcon:e.createElement(oe.default,null)},n({id:"Settings.webhooks.create.header",defaultMessage:"Create new header"}))))})))};var l=t(75515),C=t(86647),y=t(70968),B=t(54863);const O=B.default.svg(({theme:n,color:a})=>`
  width: ${12/16}rem;
  height: ${12/16}rem;

  path {
    fill: ${n.colors[a]};
  }
`),K=({isPending:n,statusCode:a})=>{const{formatMessage:s}=(0,W.Z)();return n?e.createElement(h.k,{gap:2,alignItems:"center"},e.createElement(O,{as:C.Z}),e.createElement(l.Z,null,s({id:"Settings.webhooks.trigger.pending",defaultMessage:"pending"}))):a>=200&&a<300?e.createElement(h.k,{gap:2,alignItems:"center"},e.createElement(O,{as:G.default,color:"success700"}),e.createElement(l.Z,null,s({id:"Settings.webhooks.trigger.success",defaultMessage:"success"}))):a>=300?e.createElement(h.k,{gap:2,alignItems:"center"},e.createElement(O,{as:y.Z,color:"danger700"}),e.createElement(l.Z,null,s({id:"Settings.error",defaultMessage:"error"})," ",a)):null};K.propTypes={isPending:E().bool.isRequired,statusCode:E().number},K.defaultProps={statusCode:void 0};const V=({statusCode:n,message:a})=>{const{formatMessage:s}=(0,W.Z)();return n>=200&&n<300?e.createElement(h.k,{justifyContent:"flex-end"},e.createElement(l.Z,{textColor:"neutral600",ellipsis:!0},s({id:"Settings.webhooks.trigger.success.label",defaultMessage:"Trigger succeeded"}))):n>=300?e.createElement(h.k,{justifyContent:"flex-end"},e.createElement(h.k,{maxWidth:(0,m.pxToRem)(250),justifyContent:"flex-end",title:a},e.createElement(l.Z,{ellipsis:!0,textColor:"neutral600"},a))):null};V.propTypes={statusCode:E().number,message:E().string},V.defaultProps={statusCode:void 0,message:void 0};const w=({onCancel:n})=>{const{formatMessage:a}=(0,W.Z)();return e.createElement(h.k,{justifyContent:"flex-end"},e.createElement("button",{onClick:n,type:"button"},e.createElement(h.k,{gap:2,alignItems:"center"},e.createElement(l.Z,{textColor:"neutral400"},a({id:"Settings.webhooks.trigger.cancel",defaultMessage:"cancel"})),e.createElement(O,{as:y.Z,color:"neutral400"}))))};w.propTypes={onCancel:E().func.isRequired};const j=({isPending:n,onCancel:a,response:s})=>{const{statusCode:c,message:v}=s,{formatMessage:Z}=(0,W.Z)();return e.createElement(N.x,{background:"neutral0",padding:5,shadow:"filterShadow",hasRadius:!0},e.createElement(_.r,{gap:4,style:{alignItems:"center"}},e.createElement(I.P,{col:3},e.createElement(l.Z,null,Z({id:"Settings.webhooks.trigger.test",defaultMessage:"Test-trigger"}))),e.createElement(I.P,{col:3},e.createElement(K,{isPending:n,statusCode:c})),e.createElement(I.P,{col:6},n?e.createElement(w,{onCancel:a}):e.createElement(V,{statusCode:c,message:v}))))};j.defaultProps={isPending:!1,onCancel(){},response:{}},j.propTypes={isPending:E().bool,onCancel:E().func,response:E().object};const b=j;var d=t(87561);const A=/(^$)|(^[A-Za-z][_0-9A-Za-z ]*$)/,Q=/(^$)|((https?:\/\/.*)(d*)\/?(.*))/,Ce=({formatMessage:n})=>d.object().shape({name:d.string().required(n({id:"Settings.webhooks.validation.name.required",defaultMessage:"Name is required"})).matches(A,n({id:"Settings.webhooks.validation.name.regex",defaultMessage:"The name must start with a letter and only contain letters, numbers, spaces and underscores"})),url:d.string().required(n({id:"Settings.webhooks.validation.url.required",defaultMessage:"Url is required"})).matches(Q,n({id:"Settings.webhooks.validation.url.regex",defaultMessage:"The value must be a valid Url"})),headers:d.lazy(a=>{let s=d.array();if(a.length===1){const{key:c,value:v}=a[0];if(!c&&!v)return s}return s.of(d.object().shape({key:d.string().required(n({id:"Settings.webhooks.validation.key",defaultMessage:"Key is required"})),value:d.string().required(n({id:"Settings.webhooks.validation.value",defaultMessage:"Value is required"}))}))}),events:d.array()});var ye=function(){return window&&window.strapi&&window.strapi.isEE?t(65224).Z:t(93016).Z}(),he=function(a){var s,c,v=a.handleSubmit,Z=a.triggerWebhook,u=a.isCreating,F=a.isTriggering,ae=a.triggerResponse,r=a.data,$=(0,W.Z)(),U=$.formatMessage,se=(0,e.useState)(!1),ie=(0,L.Z)(se,2),ve=ie[0],de=ie[1],fe=function(z){return Object.keys(z).length?Object.entries(z).map(function(J){var M=(0,L.Z)(J,2),R=M[0],be=M[1];return{key:R,value:be}}):[{key:"",value:""}]},T=(0,D.useFormik)({initialValues:{name:r?.name||"",url:r?.url||"",headers:fe(r?.headers||{}),events:r?.events||[]},onSubmit:function(z,J){var M=J.resetForm,R=J.setSubmitting;v(z),M({values:z}),R(!1)},validationSchema:Ce({formatMessage:U}),validateOnChange:!1,validateOnBlur:!1});return e.createElement(D.FormikProvider,{value:T},e.createElement(m.Form,{onSubmit:T.handleSubmit},e.createElement(S.T,{primaryAction:e.createElement(h.k,{gap:2},e.createElement(Y.z,{onClick:function(){Z(),de(!0)},variant:"tertiary",startIcon:e.createElement(P.Z,null),disabled:u||F,size:"L"},U({id:"Settings.webhooks.trigger",defaultMessage:"Trigger"})),e.createElement(Y.z,{startIcon:e.createElement(G.default,null),type:"submit",size:"L",disabled:!T.dirty,loading:T.isSubmitting},U({id:"global.save",defaultMessage:"Save"}))),title:u?U({id:"Settings.webhooks.create",defaultMessage:"Create a webhook"}):r?.name,navigationAction:e.createElement(m.Link,{startIcon:e.createElement(ue.Z,null),to:"/settings/webhooks"},U({id:"global.back",defaultMessage:"Back"}))}),e.createElement(ce.D,null,e.createElement(h.k,{direction:"column",alignItems:"stretch",gap:4},ve&&e.createElement(b,{isPending:F,response:ae,onCancel:function(){return de(!1)}}),e.createElement(N.x,{background:"neutral0",padding:8,shadow:"filterShadow",hasRadius:!0},e.createElement(h.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(_.r,{gap:6},e.createElement(I.P,{col:6},e.createElement(D.Field,{as:q.o,name:"name",error:(T==null||(s=T.errors)===null||s===void 0?void 0:s.name)&&T.errors.name,label:U({id:"global.name",defaultMessage:"Name"}),required:!0})),e.createElement(I.P,{col:12},e.createElement(D.Field,{as:q.o,name:"url",error:(T==null||(c=T.errors)===null||c===void 0?void 0:c.url)&&T.errors.url,label:U({id:"Settings.roles.form.input.url",defaultMessage:"Url"}),required:!0}))),e.createElement(i,null),e.createElement(ye,null)))))))};he.propTypes={data:E().object,handleSubmit:E().func.isRequired,triggerWebhook:E().func.isRequired,isCreating:E().bool.isRequired,isTriggering:E().bool.isRequired,triggerResponse:E().object},he.defaultProps={data:void 0,triggerResponse:void 0};const Me=he,pe=n=>({...n,headers:n.headers.reduce((a,{key:s,value:c})=>(s!==""&&(a[s]=c),a),{})}),Pe=()=>{const{params:{id:n}}=(0,k.$B)("/settings/webhooks/:id"),a=n==="create",{replace:s}=(0,k.k6)(),c=(0,m.useNotification)(),{formatAPIError:v}=(0,m.useAPIErrorHandler)(),Z=(0,p.useQueryClient)(),{isLoading:u}=(0,H.G)(),{put:F,get:ae,post:r}=(0,m.useFetchClient)(),{isLoading:$,data:U,error:se}=(0,p.useQuery)(["webhooks",n],async()=>{const{data:{data:M}}=await ae(`/admin/webhooks/${n}`);return M},{enabled:!a});e.useEffect(()=>{se&&c({type:"warning",message:v(se)})},[se,c,v]);const{isLoading:ie,data:ve,isIdle:de,mutate:fe}=(0,p.useMutation)(()=>r(`/admin/webhooks/${n}/trigger`)),T=()=>fe(null,{onError(M){c({type:"warning",message:v(M)})}}),re=(0,p.useMutation)(M=>r("/admin/webhooks",M)),z=(0,p.useMutation)(({id:M,body:R})=>F(`/admin/webhooks/${M}`,R)),J=async M=>{if(a){re.mutate(pe(M),{onSuccess({data:R}){c({type:"success",message:{id:"Settings.webhooks.created"}}),s(`/settings/webhooks/${R.data.id}`)},onError(R){c({type:"warning",message:v(R)})}});return}z.mutate({id:n,body:pe(M)},{onSuccess(){Z.invalidateQueries(["webhooks",n]),c({type:"success",message:{id:"notification.form.success.fields"}})},onError(R){c({type:"warning",message:v(R)})}})};return $||u?e.createElement(m.LoadingIndicatorPage,null):e.createElement(g.o,null,e.createElement(m.SettingsPageTitle,{name:"Webhooks"}),e.createElement(Me,{data:U,handleSubmit:J,triggerWebhook:T,isCreating:a,isTriggering:ie,isTriggerIdle:de,triggerResponse:ve?.data.data}))}},3672:(X,f,t)=>{t.r(f),t.d(f,{default:()=>L});var e=t(53547),g=t(67281),m=t(86706),p=t(99369),k=t(41128);const L=()=>{const S=(0,m.useSelector)(p._);return e.createElement(g.CheckPagePermissions,{permissions:S.settings.webhooks.create},e.createElement(k.Z,null))}},42122:(X,f,t)=>{t.r(f),t.d(f,{default:()=>L});var e=t(53547),g=t(67281),m=t(86706),p=t(99369),k=t(41128);const L=()=>{const S=(0,m.useSelector)(p._);return e.createElement(g.CheckPagePermissions,{permissions:S.settings.webhooks.update},e.createElement(k.Z,null))}},65224:(X,f,t)=>{t.d(f,{Z:()=>H});var e=t(53547),g=t(84714);const m={"review-workflows":["review-workflows.updateEntryStage"]},p=()=>[{id:"review-workflows.updateEntryStage",defaultMessage:"Stage Change"}];function k(){return e.createElement(g.Z.Root,null,e.createElement(g.Z.Headers,null),e.createElement(g.Z.Body,null),e.createElement(g.Z.Headers,{getHeaders:p}),e.createElement(g.Z.Body,{providedEvents:m}))}const H=k},90608:(X,f,t)=>{t.d(f,{O:()=>g});var e=t(29178);const g=e.Wx}}]);
