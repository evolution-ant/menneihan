(self.webpackChunkmynote=self.webpackChunkmynote||[]).push([[2544],{23341:(Q,q,i)=>{"use strict";i.r(q),i.d(q,{CreatePage:()=>xe,default:()=>He});var e=i(53547),O=i(185),I=i(53979),P=i(11047),B=i(29728),N=i(49066),M=i(41580),Z=i(75515),U=i(11276),de=i(67819),r=i(16364),H=i(61467),C=i(67281),Me=i(67109),Ce=i(66115),h=i(94649),A=i(27361),J=i.n(A),be=i(41609),ke=i.n(be),Ee=i(86896),v=i(86706),ve=i(16550),Re=i(54863),G=i(35650),ae=i(99369),Le=i(18280),ue=i(87561);const me=ue.object().shape({name:ue.string().required(C.translatedErrors.required),description:ue.string().required(C.translatedErrors.required)}),Ve=Re.default.div`
  border: 1px solid ${({theme:R})=>R.colors.primary200};
  background: ${({theme:R})=>R.colors.primary100};
  padding: ${({theme:R})=>`${R.spaces[2]} ${R.spaces[4]}`};
  color: ${({theme:R})=>R.colors.primary600};
  border-radius: ${({theme:R})=>R.borderRadius};
  font-size: ${12/16}rem;
  font-weight: bold;
`,xe=()=>{const R=(0,C.useNotification)(),{lockApp:_,unlockApp:W}=(0,C.useOverlayBlocker)(),{formatMessage:$}=(0,Ee.Z)(),[Y,ne]=(0,e.useState)(!1),{replace:ee}=(0,ve.k6)(),K=(0,e.useRef)(),{trackUsage:te}=(0,C.useTracking)(),je=(0,ve.$B)("/settings/roles/duplicate/:id"),ge=J()(je,"params.id",null),{isLoading:Fe,data:re}=(0,G.U_)(),{permissions:Se,isLoading:Ae}=(0,G.Dq)(ge),{post:Ie,put:Te}=(0,C.useFetchClient)(),Ge=w=>{_(),ne(!0),te(ge?"willDuplicateRole":"willCreateNewRole"),Promise.resolve(Ie("/admin/roles",w)).then(async({data:L})=>{const{permissionsToSend:j}=K.current.getPermissions();return te(ge?"didDuplicateRole":"didCreateNewRole"),L.data.id&&!ke()(j)&&await Te(`/admin/roles/${L.data.id}/permissions`,{permissions:j}),L}).then(L=>{ne(!1),R({type:"success",message:{id:"Settings.roles.created",defaultMessage:"created"}}),ee(`/settings/roles/${L.data.id}`)}).catch(L=>{console.error(L),ne(!1),R({type:"warning",message:{id:"notification.error"}})}).finally(()=>{W()})},Pe=`${$({id:"Settings.roles.form.created",defaultMessage:"Created"})} ${(0,Ce.Z)(new Date,"PPP")}`;return e.createElement(O.o,null,e.createElement(C.SettingsPageTitle,{name:"Roles"}),e.createElement(h.Formik,{initialValues:{name:"",description:Pe},onSubmit:Ge,validationSchema:me,validateOnChange:!1},({handleSubmit:w,values:L,errors:j,handleReset:ie,handleChange:le})=>e.createElement(C.Form,{noValidate:!0},e.createElement(e.Fragment,null,e.createElement(I.T,{primaryAction:e.createElement(P.k,{gap:2},e.createElement(B.z,{variant:"secondary",onClick:()=>{ie(),K.current.resetForm()},size:"L"},$({id:"app.components.Button.reset",defaultMessage:"Reset"})),e.createElement(B.z,{onClick:w,loading:Y,size:"L"},$({id:"global.save",defaultMessage:"Save"}))),title:$({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:$({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:e.createElement(C.Link,{startIcon:e.createElement(Me.Z,null),to:"/settings/roles"},$({id:"global.back",defaultMessage:"Back"}))}),e.createElement(N.D,null,e.createElement(P.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(M.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(P.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(P.k,{justifyContent:"space-between"},e.createElement(M.x,null,e.createElement(M.x,null,e.createElement(Z.Z,{fontWeight:"bold"},$({id:"global.details",defaultMessage:"Details"}))),e.createElement(M.x,null,e.createElement(Z.Z,{variant:"pi",textColor:"neutral600"},$({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})))),e.createElement(Ve,null,$({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:0}))),e.createElement(U.r,{gap:4},e.createElement(de.P,{col:6},e.createElement(r.o,{name:"name",error:j.name&&$({id:j.name}),label:$({id:"global.name",defaultMessage:"Name"}),onChange:le,value:L.name})),e.createElement(de.P,{col:6},e.createElement(H.g,{label:$({id:"global.description",defaultMessage:"Description"}),id:"description",error:j.description&&$({id:j.description}),onChange:le},L.description))))),!Fe&&!Ae?e.createElement(M.x,{shadow:"filterShadow",hasRadius:!0},e.createElement(Le.Z,{isFormDisabled:!1,ref:K,permissions:Se,layout:re})):e.createElement(M.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(C.LoadingIndicatorPage,null))))))))};function He(){const R=(0,v.useSelector)(ae._);return e.createElement(C.CheckPagePermissions,{permissions:R.settings.roles.create},e.createElement(xe,null))}},18280:(Q,q,i)=>{"use strict";i.d(q,{Z:()=>es});var e=i(53547),O=i(82777),I=i(77296),P=i(42761),B=i(67281),N=i(18721),M=i.n(N),Z=i(41609),U=i.n(Z),de=i(45697),r=i.n(de),H=i(86896),C=i(41580),Me=i(89734),Ce=i.n(Me),h=i(54863),A=i(11047),J=i(92155),be=i(52337),ke=i(66942),Ee=i(27361),v=i.n(Ee),ve=i(57557),Re=i.n(ve),G=i(35650),ae=i(29728),Le=i(78114);const ue=h.default.div`
  position: relative;

  ${({hasConditions:t,disabled:n,theme:o})=>t&&`
    &:before {
      content: '';
      position: absolute;
      top: -3px;
      left: -10px;
      width: 6px;
      height: 6px;
      border-radius: ${20/16}rem;;
      background: ${n?o.colors.neutral100:o.colors.primary600};
    }
  `}
`,De=({onClick:t,className:n,hasConditions:o,variant:s})=>{const{formatMessage:a}=(0,H.Z)();return e.createElement(ue,{hasConditions:o,className:n},e.createElement(ae.z,{variant:s,startIcon:e.createElement(Le.Z,null),onClick:t},a({id:"global.settings",defaultMessage:"Settings"})))};De.defaultProps={className:null,hasConditions:!1,variant:"tertiary"},De.propTypes={onClick:r().func.isRequired,className:r().string,hasConditions:r().bool,variant:r().string};const me=(0,h.default)(De)``;var Ve=i(42866),xe=i(24969),He=i(59946),R=i(75515),_=i(36856),W=i(63321),$=i(36773),Y=i(18172),ne=i(7739),ee=i.n(ne),K=i(11700),te=i.n(K),je=i(38953);const ge=t=>Object.values(t).map(n=>Object.entries(n).filter(([,o])=>o).map(([o])=>o)).flat(),Fe=t=>t.reduce((n,[o,s])=>(n.push({label:te()(o),children:s.map(a=>({label:a.displayName,value:a.id}))}),n),[]),re=(t,n)=>t.map(([,o])=>o).flat().reduce((o,s)=>({[s.id]:n.includes(s.id),...o}),{}),Se=({arrayOfOptionsGroupedByCategory:t,isFormDisabled:n,isGrey:o,label:s,name:a,onChange:l,value:c})=>{const{formatMessage:d}=(0,H.Z)(),m=u=>{l(a,re(t,u))};return e.createElement(A.k,{as:"li",background:o?"neutral100":"neutral0",paddingBottom:3,paddingTop:3},e.createElement(A.k,{paddingLeft:6,style:{width:180}},e.createElement(R.Z,{variant:"sigma",textColor:"neutral600"},d({id:"Settings.permissions.conditions.can",defaultMessage:"Can"}),"\xA0"),e.createElement(R.Z,{variant:"sigma",title:s,textColor:"primary600",ellipsis:!0},d({id:`Settings.roles.form.permissions.${s.toLowerCase()}`,defaultMessage:s})),e.createElement(R.Z,{variant:"sigma",textColor:"neutral600"},"\xA0",d({id:"Settings.permissions.conditions.when",defaultMessage:"When"}))),e.createElement(C.x,{style:{maxWidth:430,width:"100%"}},e.createElement(je.Q,{id:a,customizeContent:u=>`${u.length} currently selected`,onChange:m,value:ge(c),options:Fe(t),disabled:n})))};Se.propTypes={arrayOfOptionsGroupedByCategory:r().array.isRequired,isFormDisabled:r().bool.isRequired,isGrey:r().bool.isRequired,label:r().string.isRequired,name:r().string.isRequired,value:r().object.isRequired,onChange:r().func.isRequired};const Ae=Se,Ie=(t,n)=>t.reduce((o,s)=>(o[s.id]=v()(n,s.id,!1),o),{}),Te=(t,n)=>t.reduce((o,s)=>{const[a,l]=s,c=Ie(l,n);return o[a]=c,o},{}),Pe=(t,n,o)=>t.reduce((s,a)=>{const l=v()(n,[...a.pathToConditionsObject,"conditions"],{}),c=Te(o,l);return s[a.pathToConditionsObject.join("..")]=c,s},{}),w=({actions:t,headerBreadCrumbs:n,isFormDisabled:o,onClosed:s,onToggle:a})=>{const{formatMessage:l}=(0,H.Z)(),{availableConditions:c,modifiedData:d,onChangeConditions:m}=(0,G.$_)(),u=(0,e.useMemo)(()=>Object.entries(ee()(c,"category")),[c]),p=t.filter(({isDisplayed:g,hasSomeActionsSelected:S,hasAllActionsSelected:E})=>g&&(S||E)),f=(0,e.useMemo)(()=>Pe(p,d,u),[p,d,u]),[b,k]=(0,e.useState)(f),x=(g,S)=>{k((0,Y.default)(E=>{E[g]||(E[g]={}),E[g].default||(E[g].default={}),E[g].default=S}))},y=()=>{const g=Object.entries(b).reduce((S,E)=>{const[T,z]=E,F=Object.values(z).reduce((V,D)=>({...V,...D}),{});return S[T]=F,S},{});m(g),a()};return e.createElement(Ve.P,{labelledBy:"condition-modal-breadcrumbs",onClose:s},e.createElement(xe.x,null,e.createElement(W.O,{id:"condition-modal-breadcrumbs",label:n.join(", ")},n.map((g,S,E)=>e.createElement($.$,{isCurrent:S===E.length-1,key:g},te()(l({id:g,defaultMessage:g})))))),e.createElement(He.f,null,p.length===0&&e.createElement(R.Z,null,l({id:"Settings.permissions.conditions.no-actions",defaultMessage:"You first need to select actions (create, read, update, ...) before defining conditions on them."})),e.createElement("ul",null,p.map(({actionId:g,label:S,pathToConditionsObject:E},T)=>{const z=E.join("..");return e.createElement(Ae,{key:g,arrayOfOptionsGroupedByCategory:u,label:S,isFormDisabled:o,isGrey:T%2===0,name:z,onChange:x,value:v()(b,z,{})})}))),e.createElement(_.m,{startActions:e.createElement(ae.z,{variant:"tertiary",onClick:a},l({id:"app.components.Button.cancel",defaultMessage:"Cancel"})),endActions:e.createElement(ae.z,{onClick:y},l({id:"Settings.permissions.conditions.apply",defaultMessage:"Apply"}))}))};w.propTypes={actions:r().arrayOf(r().shape({actionId:r().string.isRequired,checkboxName:r().string,hasSomeActionsSelected:r().bool.isRequired,hasAllActionsSelected:r().bool,isDisplayed:r().bool.isRequired,label:r().string})).isRequired,headerBreadCrumbs:r().arrayOf(r().string).isRequired,isFormDisabled:r().bool.isRequired,onClosed:r().func.isRequired,onToggle:r().func.isRequired};const L=w,j=`${120/16}rem`,ie=`${200/16}rem`,le=`${53/16}rem`,Ke=h.default.div`
  width: ${j};
`,ot=(0,h.default)(A.k)`
  padding-right: ${({theme:t})=>t.spaces[2]};
  overflow: hidden;
  flex: 1;
  ${({isCollapsable:t})=>t&&"cursor: pointer;"}
`,ze=({children:t,isCollapsable:n,isActive:o,isFormDisabled:s,label:a,onChange:l,onClick:c,checkboxName:d,someChecked:m,value:u})=>{const{formatMessage:p}=(0,H.Z)();return e.createElement(A.k,{alignItems:"center",paddingLeft:6,style:{width:ie,flexShrink:0}},e.createElement(C.x,{paddingRight:2},e.createElement(J.C,{name:d,"aria-label":p({id:"Settings.permissions.select-all-by-permission",defaultMessage:"Select all {label} permissions"},{label:a}),disabled:s,onValueChange:f=>l({target:{name:d,value:f}}),indeterminate:m,value:u})),e.createElement(ot,{title:a,alignItems:"center",isCollapsable:n,...n&&{onClick:c,"aria-expanded":o,onKeyDown:({key:f})=>(f==="Enter"||f===" ")&&c(),tabIndex:0,role:"button"}},e.createElement(R.Z,{fontWeight:o?"bold":"",textColor:o?"primary600":"neutral800",ellipsis:!0},te()(a)),t))};ze.defaultProps={children:null,checkboxName:"",onChange(){},value:!1,someChecked:!1,isCollapsable:!1},ze.propTypes={checkboxName:r().string,children:r().node,label:r().string.isRequired,isCollapsable:r().bool,isFormDisabled:r().bool.isRequired,onChange:r().func,onClick:r().func.isRequired,someChecked:r().bool,value:r().bool,isActive:r().bool.isRequired};const rt=(0,e.memo)(ze);var Nt=i(42348),Zt=i.n(Nt),Vt=i(13218),pe=i.n(Vt);const at=t=>pe()(t)?Zt()(Object.values(t).map(n=>pe()(n)?at(n):n)):[],$e=at,Ue=t=>t?Object.keys(t).reduce((n,o)=>(o!=="conditions"&&(n[o]=t[o]),n),{}):null,fe=t=>{const n=Ue(t),o=$e(n);if(!o.length)return{hasAllActionsSelected:!1,hasSomeActionsSelected:!1};const s=o.every(l=>l),a=o.some(l=>l)&&!s;return{hasAllActionsSelected:s,hasSomeActionsSelected:a}};var Ht=i(12645);const Be=(0,h.default)(Ht.Z)`
  display: none;
  width: ${10/16}rem;
  transform: rotate(${({$isActive:t})=>t?"180":"0"}deg);
  margin-left: ${({theme:t})=>t.spaces[2]};
`,Ne=t=>`
  ${R.Z} {
    color: ${t.colors.primary600};
    font-weight: ${t.fontWeights.bold}
  }
  ${Be} {
    display: block;
    path {
      fill: ${t.colors.primary600}
    };
  }
`,Gt=(t,n,o)=>t.map(({actionId:s,isDisplayed:a,applyToProperties:l,label:c})=>{if(!a)return{actionId:s,hasSomeActionsSelected:!1,isDisplayed:a};const d=[...o.split(".."),s],m=U()(l)?[...d,"properties","enabled"]:d,u=m.join(".."),p=v()(n,[...d,"conditions"],null),f=$e(p).some(y=>y);if(U()(l)){const y=v()(n,m,!1);return{actionId:s,checkboxName:u,hasAllActionsSelected:y,hasConditions:f,hasSomeActionsSelected:y,isDisplayed:a,isParentCheckbox:!1,label:c,pathToConditionsObject:d}}const b=v()(n,m,null),{hasAllActionsSelected:k,hasSomeActionsSelected:x}=fe(b);return{actionId:s,checkboxName:u,hasAllActionsSelected:k,hasConditions:f,hasSomeActionsSelected:x,isDisplayed:a,isParentCheckbox:!0,label:c,pathToConditionsObject:d}}),Xe=(t,n)=>`
  ${it} {
    background-color: ${t.colors.primary100};
    color: ${t.colors.primary600};
    border-radius: ${n?"2px 2px 0 0":"2px"};
  }
  ${ct} {
    display: flex;
  }
  ${me} {
    display: block;
  }
  &:hover {
   ${Ne(t)}
  }

  &:focus-within {
    ${({theme:o,isActive:s})=>Xe(o,s)}
  }
  
`,it=h.default.div`
  flex: 1;
  display: flex;
  align-items: center;
  height: ${le};
  background-color: ${({isGrey:t,theme:n})=>t?n.colors.neutral100:n.colors.neutral0};
  border: 1px solid transparent;
`,Wt=h.default.div`
  display: inline-flex;
  min-width: 100%;

  ${me} {
    display: none;
  }
  ${({isActive:t,theme:n})=>t&&Xe(n,t)}
  &:hover {
    ${({theme:t,isActive:n})=>Xe(t,n)}
  }
`,lt=(0,h.default)(A.k)`
  width: ${j};
  position: relative;
`,ct=(0,h.default)(C.x)`
  display: none;
  svg {
    width: 11px;
  }
  * {
    fill: ${({theme:t})=>t.colors.primary600};
  }
`,dt=h.default.span`
  position: absolute;
  top: -6px;
  left: 37px;
  width: 6px;
  height: 6px;
  border-radius: 20px;
  background: ${({theme:t})=>t.colors.primary600};
`,Kt=(0,h.default)(C.x)`
  position: absolute;
  right: 9px;
  transform: translateY(10px);
`,ut=({availableActions:t,isActive:n,isGrey:o,isFormDisabled:s,label:a,onClickToggle:l,pathToData:c})=>{const[d,m]=(0,e.useState)(!1),{formatMessage:u}=(0,H.Z)(),{modifiedData:p,onChangeParentCheckbox:f,onChangeSimpleCheckbox:b}=(0,G.$_)(),k=()=>{m(F=>!F)},x=()=>{m(!1)},y=v()(p,c.split(".."),{}),g=(0,e.useMemo)(()=>Object.keys(y).reduce((F,V)=>(F[V]=Re()(y[V],"conditions"),F),{}),[y]),{hasAllActionsSelected:S,hasSomeActionsSelected:E}=fe(g),T=(0,e.useMemo)(()=>Gt(t,p,c),[t,p,c]),z=T.some(({hasConditions:F})=>F);return e.createElement(Wt,{isActive:n},e.createElement(it,{isGrey:o},e.createElement(rt,{isCollapsable:!0,isFormDisabled:s,label:a,checkboxName:c,onChange:f,onClick:l,someChecked:E,value:S,isActive:n},e.createElement(ct,{paddingLeft:2},n?e.createElement(be.Z,null):e.createElement(ke.Z,null))),e.createElement(A.k,{style:{flex:1}},T.map(({actionId:F,hasConditions:V,hasAllActionsSelected:D,hasSomeActionsSelected:oe,isDisplayed:Oe,isParentCheckbox:X,checkboxName:ce,label:Ze})=>Oe?X?e.createElement(lt,{key:F,justifyContent:"center",alignItems:"center"},V&&e.createElement(dt,null),e.createElement(J.C,{disabled:s,name:ce,"aria-label":u({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${Ze} ${a}`}),onValueChange:ye=>{f({target:{name:ce,value:ye}})},indeterminate:oe,value:D})):e.createElement(lt,{key:F,justifyContent:"center",alignItems:"center"},V&&e.createElement(dt,null),e.createElement(J.C,{disabled:s,indeterminate:V,name:ce,onValueChange:ye=>{b({target:{name:ce,value:ye}})},value:D})):e.createElement(Ke,{key:F}))),d&&e.createElement(L,{headerBreadCrumbs:[a,"Settings.permissions.conditions.conditions"],actions:T,isFormDisabled:s,onClosed:x,onToggle:k})),e.createElement(Kt,null,e.createElement(me,{onClick:k,hasConditions:z})))};ut.propTypes={availableActions:r().array.isRequired,isActive:r().bool.isRequired,isGrey:r().bool.isRequired,isFormDisabled:r().bool.isRequired,label:r().string.isRequired,onClickToggle:r().func.isRequired,pathToData:r().string.isRequired};const zt=ut,Ut=h.default.span`
  color: ${({theme:t})=>t.colors.danger700};
  padding-left: ${({theme:t})=>t.spaces[1]}px;
`,mt=()=>e.createElement(Ut,null,"*"),Xt=(t,n)=>t.map(o=>{const s=Array.isArray(o.subjects)&&o.subjects.indexOf(n)!==-1;return{...o,isDisplayed:s}}),qt=(0,h.default)(C.x)`
  transform: translate(-4px, -12px);

  &:before {
    content: '';
    width: ${4/16}rem;
    height: ${12/16}rem;
    background: ${({theme:t})=>t.colors.primary200};
    display: block;
  }
`,Yt=h.default.svg`
  position: relative;
  flex-shrink: 0;
  transform: translate(-0.5px, -1px);

  * {
    fill: ${({theme:t,color:n})=>t.colors[n]};
  }
`,qe=t=>e.createElement(qt,null,e.createElement(Yt,{width:"20",height:"23",viewBox:"0 0 20 23",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},e.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.02477 14.7513C8.65865 17.0594 11.6046 18.6059 17.5596 18.8856C18.6836 18.9384 19.5976 19.8435 19.5976 20.9688V20.9688C19.5976 22.0941 18.6841 23.0125 17.5599 22.9643C10.9409 22.6805 6.454 20.9387 3.75496 17.1258C0.937988 13.1464 0.486328 7.39309 0.486328 0.593262H4.50974C4.50974 7.54693 5.06394 11.9813 7.02477 14.7513Z",fill:"#D9D8FF"})));qe.defaultProps={fill:"primary200"},qe.propTypes={fill:r().string};const wt=(0,e.memo)(qe),pt=(0,h.default)(A.k)`
  width: ${j};
  position: relative;
`,Qt=(0,h.default)(A.k)`
  height: ${le};
`,Jt=(0,h.default)(C.x)`
  padding-left: ${31/16}rem;
`,_t=(0,h.default)(C.x)`
  border-left: ${({isVisible:t,theme:n})=>t?`4px solid ${n.colors.primary200}`:"4px solid transparent"};
`,en=(0,h.default)(A.k)`
  padding-left: ${({theme:t})=>t.spaces[4]};
  width: ${({level:t})=>145-t*36}px;

  ${({isCollapsable:t,theme:n})=>t&&`
      ${Be} {
        display: block;
        color: ${n.colors.neutral100};
      }
      &:hover {
        ${Ne(n)}
      }
  `}
  ${({isActive:t,theme:n})=>t&&Ne(n)};
`,tn=h.default.div`
  padding-top: ${({theme:t})=>t.spaces[2]};
  margin-top: ${({theme:t})=>t.spaces[2]};
  width: ${4/16}rem;
  background-color: ${({theme:t})=>t.colors.primary200};
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
`,Ye=({childrenForm:t,isFormDisabled:n,recursiveLevel:o,pathToDataFromActionRow:s,propertyActions:a,parentName:l,propertyName:c})=>{const{formatMessage:d}=(0,H.Z)(),{modifiedData:m,onChangeParentCheckbox:u,onChangeSimpleCheckbox:p}=(0,G.$_)(),[f,b]=(0,e.useState)(null),k=y=>{b(g=>g===y?null:y)},x=(0,e.useMemo)(()=>f?t.find(({value:y})=>y===f):null,[f,t]);return e.createElement(Jt,null,e.createElement(tn,null),t.map(({label:y,value:g,required:S,children:E},T)=>{const z=T+1<t.length,F=Array.isArray(E),V=f===g;return e.createElement(_t,{key:g,isVisible:z},e.createElement(Qt,null,e.createElement(wt,{color:"primary200"}),e.createElement(A.k,{style:{flex:1}},e.createElement(en,{level:o,isActive:V,isCollapsable:F},e.createElement(ot,{alignItems:"center",isCollapsable:F,...F&&{onClick:()=>k(g),"aria-expanded":V,onKeyDown:({key:D})=>(D==="Enter"||D===" ")&&k(g),tabIndex:0,role:"button"},title:y},e.createElement(R.Z,{ellipsis:!0},te()(y)),S&&e.createElement(mt,null),e.createElement(Be,{$isActive:V}))),e.createElement(A.k,{style:{flex:1}},a.map(({actionId:D,label:oe,isActionRelatedToCurrentProperty:Oe})=>{if(!Oe)return e.createElement(Ke,{key:D});const X=[...s.split(".."),D,"properties",c,...l.split(".."),g],ce=v()(m,X,!1);if(!E)return e.createElement(pt,{key:oe,justifyContent:"center",alignItems:"center"},e.createElement(J.C,{disabled:n,name:X.join(".."),"aria-label":d({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${l} ${y} ${oe}`}),onValueChange:he=>{p({target:{name:X.join(".."),value:he}})},value:ce}));const{hasAllActionsSelected:Ze,hasSomeActionsSelected:ye}=fe(ce);return e.createElement(pt,{key:oe,justifyContent:"center",alignItems:"center"},e.createElement(J.C,{key:oe,disabled:n,name:X.join(".."),"aria-label":d({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${l} ${y} ${oe}`}),onValueChange:he=>{u({target:{name:X.join(".."),value:he}})},value:Ze,indeterminate:ye}))})))),x&&V&&e.createElement(C.x,{paddingBottom:2},e.createElement(Ye,{isFormDisabled:n,parentName:`${l}..${g}`,pathToDataFromActionRow:s,propertyActions:a,propertyName:c,recursiveLevel:o+1,childrenForm:x.children})))}))};Ye.propTypes={childrenForm:r().array.isRequired,isFormDisabled:r().bool.isRequired,parentName:r().string.isRequired,pathToDataFromActionRow:r().string.isRequired,propertyActions:r().array.isRequired,propertyName:r().string.isRequired,recursiveLevel:r().number.isRequired};const nn=(0,e.memo)(Ye),sn=t=>t.reduce((o,s)=>(s.isActionRelatedToCurrentProperty&&o.push(s.actionId),o),[]),on=(t,n,o,s,a)=>{const c=sn(t).reduce((d,m)=>{const u=[...o.split(".."),m,"properties",s,a],p=v()(n,u,!1);return d[m]=p,d},{});return fe(c)},gt=(0,h.default)(A.k)`
  width: ${j};
  position: relative;
`,rn=(0,h.default)(A.k)`
  height: ${le};
  flex: 1;

  ${({isCollapsable:t,theme:n})=>t&&`
      ${Be} {
        display: block;
        color: ${n.colors.neutral100};
      }
      &:hover {
        ${Ne(n)}
      }
  `}
  ${({isActive:t,theme:n})=>t&&Ne(n)};
`,we=({childrenForm:t,label:n,isFormDisabled:o,name:s,required:a,pathToData:l,propertyActions:c,propertyName:d,isOdd:m})=>{const{formatMessage:u}=(0,H.Z)(),[p,f]=(0,e.useState)(null),{modifiedData:b,onChangeCollectionTypeLeftActionRowCheckbox:k,onChangeParentCheckbox:x,onChangeSimpleCheckbox:y}=(0,G.$_)(),g=p===s,S=(0,e.useMemo)(()=>Array.isArray(t)?t:[],[t]),E=S.length>0,T=(0,e.useCallback)(()=>{E&&f(D=>D===s?null:s)},[E,s]),z=({target:{value:D}})=>{k(l,d,s,D)},{hasAllActionsSelected:F,hasSomeActionsSelected:V}=(0,e.useMemo)(()=>on(c,b,l,d,s),[c,b,l,d,s]);return e.createElement(e.Fragment,null,e.createElement(rn,{alignItems:"center",isCollapsable:E,isActive:g,background:m?"neutral100":"neutral0"},e.createElement(A.k,null,e.createElement(rt,{onChange:z,onClick:T,isCollapsable:E,isFormDisabled:o,label:n,someChecked:V,value:F,isActive:g},a&&e.createElement(mt,null),e.createElement(Be,{$isActive:g})),e.createElement(A.k,null,c.map(({label:D,isActionRelatedToCurrentProperty:oe,actionId:Oe})=>{if(!oe)return e.createElement(Ke,{key:D});const X=[...l.split(".."),Oe,"properties",d,s];if(!E){const he=v()(b,X,!1);return e.createElement(gt,{key:Oe,justifyContent:"center",alignItems:"center"},e.createElement(J.C,{disabled:o,name:X.join(".."),"aria-label":u({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${s} ${D}`}),onValueChange:ts=>{y({target:{name:X.join(".."),value:ts}})},value:he}))}const ce=v()(b,X,{}),{hasAllActionsSelected:Ze,hasSomeActionsSelected:ye}=fe(ce);return e.createElement(gt,{key:D,justifyContent:"center",alignItems:"center"},e.createElement(J.C,{disabled:o,name:X.join(".."),onValueChange:he=>{x({target:{name:X.join(".."),value:he}})},"aria-label":u({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${s} ${D}`}),value:Ze,indeterminate:ye}))})))),g&&e.createElement(nn,{childrenForm:S,isFormDisabled:o,parentName:s,pathToDataFromActionRow:l,propertyName:d,propertyActions:c,recursiveLevel:0}))};we.defaultProps={childrenForm:[],required:!1},we.propTypes={childrenForm:r().array,label:r().string.isRequired,isFormDisabled:r().bool.isRequired,name:r().string.isRequired,pathToData:r().string.isRequired,propertyActions:r().array.isRequired,propertyName:r().string.isRequired,required:r().bool,isOdd:r().bool.isRequired};const an=(0,e.memo)(we),ft=(0,h.default)(A.k)`
  width: ${j};
  flex-shrink: 0;
`,ln=(0,h.default)(A.k)`
  width: ${ie};
  height: ${le};
  flex-shrink: 0;
`,yt=({headers:t,label:n})=>{const{formatMessage:o}=(0,H.Z)(),s=o({id:"Settings.roles.form.permission.property-label",defaultMessage:"{label} permissions"},{label:n});return e.createElement(A.k,null,e.createElement(ln,{alignItems:"center",paddingLeft:6},e.createElement(R.Z,{variant:"sigma",textColor:"neutral500"},s)),t.map(a=>a.isActionRelatedToCurrentProperty?e.createElement(ft,{justifyContent:"center",key:a.label},e.createElement(R.Z,{variant:"sigma",textColor:"neutral500"},o({id:`Settings.roles.form.permissions.${a.label.toLowerCase()}`,defaultMessage:a.label}))):e.createElement(ft,{key:a.label})))};yt.propTypes={headers:r().arrayOf(r().shape({label:r().string.isRequired,isActionRelatedToCurrentProperty:r().bool.isRequired})).isRequired,label:r().string.isRequired};const cn=yt,dn=(t,n)=>t.map(o=>{const s=Array.isArray(o.applyToProperties)&&o.applyToProperties.indexOf(n)!==-1&&o.isDisplayed;return{label:o.label,actionId:o.actionId,isActionRelatedToCurrentProperty:s}}),un=h.default.div`
  display: inline-flex;
  flex-direction: column;
  min-width: 0;
`,ht=({availableActions:t,childrenForm:n,isFormDisabled:o,label:s,pathToData:a,propertyName:l})=>{const c=(0,e.useMemo)(()=>dn(t,l),[t,l]);return e.createElement(un,null,e.createElement(cn,{label:s,headers:c}),e.createElement(C.x,null,n.map(({children:d,label:m,value:u,required:p},f)=>e.createElement(an,{childrenForm:d,key:u,label:m,isFormDisabled:o,name:u,required:p,propertyActions:c,pathToData:a,propertyName:l,isOdd:f%2===0}))))};ht.propTypes={childrenForm:r().array.isRequired,availableActions:r().array.isRequired,isFormDisabled:r().bool.isRequired,label:r().string.isRequired,pathToData:r().string.isRequired,propertyName:r().string.isRequired};const mn=ht,pn=h.default.div`
  flex-direction: column;
  display: inline-flex;
  min-width: 100%;
  ${({theme:t,isActive:n})=>n&&`border: 1px solid ${t.colors.primary600};`}
`,Ct=({allActions:t,contentTypeName:n,label:o,index:s,isActive:a,isFormDisabled:l,onClickToggleCollapse:c,pathToData:d,properties:m})=>{const u=(0,e.useCallback)(()=>{c(n)},[n,c]),p=(0,e.useMemo)(()=>Xt(t,n),[t,n]);return e.createElement(pn,{isActive:a},e.createElement(zt,{availableActions:p,isActive:a,isGrey:s%2===0,isFormDisabled:l,label:o,onClickToggle:u,pathToData:d}),a&&m.map(({label:f,value:b,children:k})=>e.createElement(mn,{availableActions:p,childrenForm:k,isFormDisabled:l,label:f,pathToData:d,propertyName:b,key:b})))};Ct.propTypes={allActions:r().array.isRequired,contentTypeName:r().string.isRequired,index:r().number.isRequired,isActive:r().bool.isRequired,isFormDisabled:r().bool.isRequired,label:r().string.isRequired,onClickToggleCollapse:r().func.isRequired,pathToData:r().string.isRequired,properties:r().array.isRequired};const gn=Ct,Qe=({actions:t,isFormDisabled:n,pathToData:o,subjects:s})=>{const[a,l]=(0,e.useState)(null),c=d=>{l(a===d?null:d)};return s.map(({uid:d,label:m,properties:u},p)=>e.createElement(gn,{allActions:t,key:d,contentTypeName:d,label:m,isActive:a===d,isFormDisabled:n,index:p,onClickToggleCollapse:c,pathToData:`${o}..${d}`,properties:u}))};Qe.defaultProps={actions:[],subjects:[]},Qe.propTypes={actions:r().array.isRequired,isFormDisabled:r().bool.isRequired,pathToData:r().string.isRequired,subjects:r().arrayOf(r().shape({uid:r().string.isRequired,label:r().string.isRequired,properties:r().array.isRequired}))};const fn=(0,e.memo)(Qe),yn=t=>t.filter(({subjects:n})=>n&&n.length),hn=t=>t.map(({actionId:n})=>n),Cn=(t,n)=>t.reduce((o,s)=>(Object.keys(n).forEach(a=>{const l=v()(n,[a,s],{}),c={[a]:Ue(l)};o[s]?o[s]={...o[s],...c}:o[s]=c}),o),{}),bn=(t,n)=>{const o=hn(t),s=Cn(o,n);return Object.keys(s).reduce((l,c)=>(l[c]=fe(s[c]),l),{})},En=(0,h.default)(A.k)`
  width: ${j};
  flex-shrink: 0;
`,Je=({actions:t,isFormDisabled:n,kind:o})=>{const{formatMessage:s}=(0,H.Z)(),{modifiedData:a,onChangeCollectionTypeGlobalActionCheckbox:l}=(0,G.$_)(),c=(0,e.useMemo)(()=>yn(t),[t]),d=(0,e.useMemo)(()=>bn(c,a[o]),[a,c,o]);return e.createElement(C.x,{paddingBottom:4,paddingTop:6,style:{paddingLeft:ie}},e.createElement(A.k,{gap:0},c.map(({label:m,actionId:u})=>e.createElement(En,{direction:"column",alignItems:"center",justifyContent:"center",key:u,gap:3},e.createElement(R.Z,{variant:"sigma",textColor:"neutral500"},s({id:`Settings.roles.form.permissions.${m.toLowerCase()}`,defaultMessage:m})),e.createElement(J.C,{disabled:n,onValueChange:p=>{l(o,u,p)},name:u,"aria-label":s({id:"Settings.permissions.select-all-by-permission",defaultMessage:"Select all {label} permissions"},{label:s({id:`Settings.roles.form.permissions.${m.toLowerCase()}`,defaultMessage:m})}),value:v()(d,[u,"hasAllActionsSelected"],!1),indeterminate:v()(d,[u,"hasSomeActionsSelected"],!1)})))))};Je.defaultProps={actions:[]},Je.propTypes={actions:r().arrayOf(r().shape({label:r().string.isRequired,actionId:r().string.isRequired,subjects:r().array.isRequired})),isFormDisabled:r().bool.isRequired,kind:r().string.isRequired};const vn=(0,e.memo)(Je),Rn=(0,h.default)(C.x)`
  overflow-x: auto;
`,bt=({isFormDisabled:t,kind:n,layout:{actions:o,subjects:s}})=>{const a=Ce()([...s],"label");return e.createElement(Rn,{background:"neutral0"},e.createElement(vn,{actions:o,kind:n,isFormDisabled:t}),e.createElement(fn,{actions:o,isFormDisabled:t,pathToData:n,subjects:a}))};bt.propTypes={isFormDisabled:r().bool.isRequired,kind:r().string.isRequired,layout:r().shape({actions:r().array,subjects:r().arrayOf(r().shape({uid:r().string.isRequired,label:r().string.isRequired,properties:r().array.isRequired}))}).isRequired};const Et=(0,e.memo)(bt);var xn=i(47713);const vt=({children:t,value:n})=>e.createElement(xn.$l.Provider,{value:n},t);vt.propTypes={children:r().node.isRequired,value:r().exact({availableConditions:r().array.isRequired,modifiedData:r().object.isRequired,onChangeCollectionTypeLeftActionRowCheckbox:r().func.isRequired,onChangeConditions:r().func.isRequired,onChangeSimpleCheckbox:r().func.isRequired,onChangeParentCheckbox:r().func.isRequired,onChangeCollectionTypeGlobalActionCheckbox:r().func.isRequired}).isRequired};const Sn=vt;var An=i(48734),Tn=i(74756),Pn=i(63081),Rt=i(36213),$n=i(11276),On=i(67819);const Mn=(t,n,o)=>t.map(s=>{const a=[...o,s.action,"properties","enabled"],l=v()(n,a,!1),c=v()(n,[...o,s.action,"conditions"],{}),d=$e(c).some(m=>m);return{...s,isDisplayed:l,checkboxName:a.join(".."),hasSomeActionsSelected:l,value:l,hasConditions:d,label:s.displayName,actionId:s.action,pathToConditionsObject:[...o,s.action]}}),kn=t=>{const n=Object.entries(t).reduce((s,a)=>{const[l,{conditions:c}]=a;return s[l]=c,s},{});return $e(n).some(s=>s)},Ln=h.default.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:t})=>t.colors.neutral150};
`,Dn=h.default.div`
  position: relative;
  word-break: keep-all;
  ${({hasConditions:t,disabled:n,theme:o})=>t&&`
    &:before {
      content: '';
      position: absolute;
      top: ${-4/16}rem;
      left: ${-8/16}rem;
      width: ${6/16}rem;
      height: ${6/16}rem;
      border-radius: ${20/16}rem;
      background: ${n?o.colors.neutral100:o.colors.primary600};
    }
  `}
`,xt=({categoryName:t,isFormDisabled:n,subCategoryName:o,actions:s,pathToData:a})=>{const[l,c]=(0,e.useState)(!1),{modifiedData:d,onChangeParentCheckbox:m,onChangeSimpleCheckbox:u}=(0,G.$_)(),{formatMessage:p}=(0,H.Z)(),f=v()(d,a,{}),b=(0,e.useMemo)(()=>Object.keys(f).reduce((T,z)=>(T[z]=Ue(f[z]),T),{}),[f]),{hasAllActionsSelected:k,hasSomeActionsSelected:x}=fe(b),y=()=>{c(T=>!T)},g=()=>{c(!1)},S=Mn(s,d,a),E=kn(v()(d,[...a],{}));return e.createElement(e.Fragment,null,e.createElement(C.x,null,e.createElement(A.k,{justifyContent:"space-between",alignItems:"center"},e.createElement(C.x,{paddingRight:4},e.createElement(R.Z,{variant:"sigma",textColor:"neutral600"},o)),e.createElement(Ln,null),e.createElement(C.x,{paddingLeft:4},e.createElement(Rt.X,{name:a.join(".."),disabled:n,onValueChange:T=>{m({target:{name:a.join(".."),value:T}})},indeterminate:x,value:k},p({id:"app.utils.select-all",defaultMessage:"Select all"})))),e.createElement(A.k,{paddingTop:6,paddingBottom:6},e.createElement($n.r,{gap:2,style:{flex:1}},S.map(({checkboxName:T,value:z,action:F,displayName:V,hasConditions:D})=>e.createElement(On.P,{col:3,key:F},e.createElement(Dn,{disabled:n,hasConditions:D},e.createElement(Rt.X,{name:T,disabled:n,onValueChange:oe=>{u({target:{name:T,value:oe}})},value:z},V))))),e.createElement(me,{hasConditions:E,onClick:y}))),l&&e.createElement(L,{headerBreadCrumbs:[t,o],actions:S,isFormDisabled:n,onClosed:g,onToggle:y}))};xt.propTypes={actions:r().array.isRequired,categoryName:r().string.isRequired,isFormDisabled:r().bool.isRequired,subCategoryName:r().string.isRequired,pathToData:r().array.isRequired};const jn=xt,_e=({childrenForm:t,kind:n,name:o,isOpen:s,isFormDisabled:a,isWhite:l,onOpenCategory:c,pathToData:d})=>{const{formatMessage:m}=(0,H.Z)(),u=()=>{c(o)},p=(0,e.useMemo)(()=>o.split("::").pop(),[o]);return e.createElement(An.U,{expanded:s,onToggle:u,id:`accordion-${o}`,variant:l?"primary":"secondary"},e.createElement(Tn.B,{title:te()(p),description:`${m({id:"Settings.permissions.category"},{category:p})} ${n==="plugins"?"plugin":n}`}),e.createElement(Pn.v,null,e.createElement(C.x,{padding:6},t.map(({actions:f,subCategoryName:b,subCategoryId:k})=>e.createElement(jn,{key:b,actions:f,categoryName:p,isFormDisabled:a,subCategoryName:b,pathToData:[...d,k]})))))};_e.defaultProps={},_e.propTypes={childrenForm:r().array.isRequired,isOpen:r().bool.isRequired,isFormDisabled:r().bool.isRequired,isWhite:r().bool.isRequired,kind:r().string.isRequired,name:r().string.isRequired,onOpenCategory:r().func.isRequired,pathToData:r().array.isRequired};const Fn=_e,St=({isFormDisabled:t,kind:n,layout:o})=>{const[s,a]=(0,e.useState)(null),l=c=>{a(c===s?null:c)};return e.createElement(C.x,{padding:6,background:"neutral0"},o.map(({category:c,categoryId:d,childrenForm:m},u)=>e.createElement(Fn,{key:c,childrenForm:m,kind:n,isFormDisabled:t,isOpen:s===c,isWhite:u%2===1,name:c,onOpenCategory:l,pathToData:[n,d]})))};St.propTypes={isFormDisabled:r().bool.isRequired,kind:r().string.isRequired,layout:r().arrayOf(r().shape({category:r().string.isRequired,categoryId:r().string.isRequired,childrenForm:r().arrayOf(r().shape({actions:r().array.isRequired})).isRequired}).isRequired).isRequired};const At=St;var In=i(82492),Bn=i.n(In),Nn=i(36968),se=i.n(Nn);const Tt=(t,n,o)=>t.find(s=>s.action===n&&s.subject===o),Pt=(t,n=[])=>t.reduce((o,s)=>(o[s.id]=n.indexOf(s.id)!==-1,o),{}),$t=({children:t},n,o="")=>t.reduce((s,a)=>{if(a.children)return{...s,[a.value]:$t(a,n,`${o}${a.value}.`)};const l=n.indexOf(`${o}${a.value}`)!==-1;return s[a.value]=l,s},{}),Zn=(t,n,o)=>t.reduce((s,a)=>{const l=n.properties.find(({value:c})=>c===a);if(l){const c=v()(o,["properties",l.value],[]),d=$t(l,c);s.properties[a]=d}return s},{properties:{}}),Vn=(t,n)=>n.reduce((o,s)=>{const a=t.find(({uid:l})=>l===s)||null;return a&&(o[s]=a),o},{}),Ot=({subjects:t},n,o,s=[])=>n.reduce((a,l)=>{const c=l.subjects,d=Vn(t,c);if(U()(d))return a;const m=Object.keys(d).reduce((u,p)=>{const{actionId:f,applyToProperties:b}=l,y=d[p].properties.map(({value:T})=>T).every(T=>(b||[]).indexOf(T)===-1),g=Tt(s,f,p),S=Pt(o,v()(g,"conditions",[]));if(U()(b)||y)return se()(u,[p,f],{properties:{enabled:g!==void 0},conditions:S}),u;const E=Zn(b,d[p],g);return se()(u,[p,f],{...E,conditions:S}),u},{});return Bn()(a,m)},{}),Hn=(t,n,o)=>t.reduce((s,a)=>{const l=Tt(o,a.action,null);return s[a.action]={properties:{enabled:l!==void 0},conditions:Pt(n,l?.conditions??[])},s},{}),Gn=(t,n,o)=>t.reduce((s,a)=>(s[a.subCategoryId]=Hn(a.actions,n,o),s),{}),Mt=(t,n,o=[])=>t.reduce((s,{categoryId:a,childrenForm:l})=>{const c=Gn(l,n,o);return s[a]=c,s},{}),kt=t=>t.split(" ").join("-"),Lt=(t,n)=>Object.entries(ee()(t,n)).map(([o,s])=>({category:o,categoryId:kt(o),childrenForm:Object.entries(ee()(s,"subCategory")).map(([a,l])=>({subCategoryName:a,subCategoryId:kt(a),actions:l}))})),Wn=(t,n)=>{const{conditions:o,sections:{collectionTypes:s,singleTypes:a,plugins:l,settings:c}}=t,d={collectionTypes:s,singleTypes:a,plugins:Lt(l,"plugin"),settings:Lt(c,"category")},m={collectionTypes:Ot(s,s.actions||[],o,n),singleTypes:Ot(a,a.actions||[],o,n),plugins:Mt(d.plugins,o,n),settings:Mt(d.settings,o,n)};return{initialData:m,modifiedData:m,layouts:d}};var Kn=i(50361),et=i.n(Kn);const Dt=t=>Object.keys(t).reduce((n,o)=>{const s=t[o];if(pe()(s)&&!M()(s,"conditions"))return{...n,[o]:Dt(s)};if(pe()(s)&&M()(s,"conditions")&&!$e(Re()(s,"conditions")).some(l=>l)){const l=Object.keys(s.conditions).reduce((c,d)=>(c[d]=!1,c),{});return{...n,[o]:{...s,conditions:l}}}return n[o]=s,n},{}),tt=Dt,jt=(t,n,o=!1)=>Object.keys(t).reduce((s,a)=>{const l=t[a];return a==="conditions"&&!o?(s[a]=l,s):pe()(l)?{...s,[a]:jt(l,n,a==="fields")}:(s[a]=n,s)},{}),We=jt,zn={initialData:{},modifiedData:{},layouts:{}},Un=(t,n)=>(0,Y.default)(t,o=>{switch(n.type){case"ON_CHANGE_COLLECTION_TYPE_GLOBAL_ACTION_CHECKBOX":{const{collectionTypeKind:s,actionId:a,value:l}=n,c=["modifiedData",s];Object.keys(v()(t,c)).forEach(d=>{const m=v()(t,[...c,d,a],void 0);if(m){let u=We(m,l);if(!l&&u.conditions){const p=We(u.conditions,!1);u={...u,conditions:p}}se()(o,[...c,d,a],u)}});break}case"ON_CHANGE_COLLECTION_TYPE_ROW_LEFT_CHECKBOX":{const{pathToCollectionType:s,propertyName:a,rowName:l,value:c}=n;let d=et()(t.modifiedData);const m=s.split(".."),u=v()(d,m,{});Object.keys(u).forEach(p=>{if(M()(u[p],`properties.${a}`)){const f=v()(u,[p,"properties",a,l]),b=[...m,p,"properties",a,l];if(!pe()(f))se()(d,b,c);else{const k=We(f,c);se()(d,b,k)}}}),c||(d=tt(d)),se()(o,"modifiedData",d);break}case"ON_CHANGE_CONDITIONS":{Object.entries(n.conditions).forEach(s=>{const[a,l]=s;se()(o,["modifiedData",...a.split(".."),"conditions"],l)});break}case"ON_CHANGE_SIMPLE_CHECKBOX":{let s=et()(t.modifiedData);se()(s,[...n.keys.split("..")],n.value),n.value||(s=tt(s)),se()(o,"modifiedData",s);break}case"ON_CHANGE_TOGGLE_PARENT_CHECKBOX":{const{keys:s,value:a}=n,l=[...s.split("..")];let c=et()(t.modifiedData);const d=v()(c,l,{}),m=We(d,a);se()(c,l,m),a||(c=tt(c)),se()(o,["modifiedData"],c);break}case"RESET_FORM":{o.modifiedData=t.initialData;break}case"SET_FORM_AFTER_SUBMIT":{o.initialData=t.modifiedData;break}default:return o}}),nt=t=>Object.entries(t).filter(([,n])=>n).map(([n])=>n),Xn=t=>{const[n,{conditions:o}]=t;return{action:n,subject:null,conditions:nt(o),properties:{}}},qn=t=>Object.values(t).reduce((n,o)=>{const s=Object.entries(o).reduce((a,l)=>{const[,{properties:{enabled:c}}]=l;if(!c)return a;const d=Xn(l);return a.push(d),a},[]);return[...n,...s]},[]),Ft=t=>Object.values(t).reduce((n,o)=>{const s=qn(o);return[...n,...s]},[]),It=(t,n="")=>Object.entries(t).reduce((o,s)=>{const[a,l]=s;return pe()(l)?[...o,...It(l,`${n}${a}.`)]:(l&&!pe()(l)&&o.push(`${n}${a}`),o)},[]),Yn=(t,n,{conditions:o,properties:s})=>Object.entries(s).reduce((a,l)=>{const[c,d]=l;return a.properties[c]=It(d),a},{action:t,subject:n,conditions:nt(o),properties:{}}),wn=(t,n,{conditions:o})=>({action:t,subject:n,properties:{},conditions:nt(o)}),Qn=(t,n)=>Object.entries(n).reduce((s,a)=>{const[l,c]=a;if(!$e(c).some(u=>u))return s;if(!c?.properties?.enabled){const u=Yn(l,t,c);return[...s,u]}if(!c.properties.enabled)return s;const m=wn(l,t,c);return s.push(m),s},[]),Bt=t=>Object.entries(t).reduce((o,s)=>{const[a,l]=s,c=Qn(a,l);return[...o,...c]},[]),Jn=t=>{const n=Ft(t.plugins),o=Ft(t.settings),s=Bt(t.collectionTypes),a=Bt(t.singleTypes);return[...n,...o,...s,...a]},_n=[{labelId:"app.components.LeftMenuLinkContainer.collectionTypes",defaultMessage:"Collection Types",id:"collectionTypes"},{labelId:"app.components.LeftMenuLinkContainer.singleTypes",id:"singleTypes",defaultMessage:"Single Types"},{labelId:"app.components.LeftMenuLinkContainer.plugins",defaultMessage:"Plugins",id:"plugins"},{labelId:"app.components.LeftMenuLinkContainer.settings",defaultMessage:"Settings",id:"settings"}],st=(0,e.forwardRef)(({layout:t,isFormDisabled:n,permissions:o},s)=>{const[{initialData:a,layouts:l,modifiedData:c},d]=(0,e.useReducer)(Un,zn,()=>Wn(t,o)),{formatMessage:m}=(0,H.Z)();(0,e.useImperativeHandle)(s,()=>({getPermissions(){const x=(0,B.difference)(a.collectionTypes,c.collectionTypes),y=(0,B.difference)(a.singleTypes,c.singleTypes),g={...x,...y};let S;return U()(g)?S=!1:S=Object.values(g).some(E=>Object.values(E).some(T=>M()(T,"conditions"))),{permissionsToSend:Jn(c),didUpdateConditions:S}},resetForm(){d({type:"RESET_FORM"})},setFormAfterSubmit(){d({type:"SET_FORM_AFTER_SUBMIT"})}}));const u=(x,y,g,S)=>{d({type:"ON_CHANGE_COLLECTION_TYPE_ROW_LEFT_CHECKBOX",pathToCollectionType:x,propertyName:y,rowName:g,value:S})},p=(x,y,g)=>{d({type:"ON_CHANGE_COLLECTION_TYPE_GLOBAL_ACTION_CHECKBOX",collectionTypeKind:x,actionId:y,value:g})},f=x=>{d({type:"ON_CHANGE_CONDITIONS",conditions:x})},b=(0,e.useCallback)(({target:{name:x,value:y}})=>{d({type:"ON_CHANGE_SIMPLE_CHECKBOX",keys:x,value:y})},[]),k=(0,e.useCallback)(({target:{name:x,value:y}})=>{d({type:"ON_CHANGE_TOGGLE_PARENT_CHECKBOX",keys:x,value:y})},[]);return e.createElement(Sn,{value:{availableConditions:t.conditions,modifiedData:c,onChangeConditions:f,onChangeSimpleCheckbox:b,onChangeParentCheckbox:k,onChangeCollectionTypeLeftActionRowCheckbox:u,onChangeCollectionTypeGlobalActionCheckbox:p}},e.createElement(O.v,{id:"tabs",label:m({id:"Settings.permissions.users.tabs.label",defaultMessage:"Tabs Permissions"})},e.createElement(I.m,null,_n.map(x=>e.createElement(I.O,{key:x.id},m({id:x.labelId,defaultMessage:x.defaultMessage})))),e.createElement(P.n,{style:{position:"relative"}},e.createElement(P.x,null,e.createElement(Et,{layout:l.collectionTypes,kind:"collectionTypes",isFormDisabled:n})),e.createElement(P.x,null,e.createElement(Et,{layout:l.singleTypes,kind:"singleTypes",isFormDisabled:n})),e.createElement(P.x,null,e.createElement(At,{layout:l.plugins,kind:"plugins",isFormDisabled:n})),e.createElement(P.x,null,e.createElement(At,{layout:l.settings,kind:"settings",isFormDisabled:n})))))});st.defaultProps={permissions:[],layout:{conditions:[],sections:{collectionTypes:{},singleTypes:{actions:[]},settings:[],plugins:[]}}},st.propTypes={layout:r().object,isFormDisabled:r().bool.isRequired,permissions:r().array};const es=(0,e.memo)(st)},92100:(Q,q,i)=>{"use strict";i.r(q),i.d(q,{default:()=>R});var e=i(53547),O=i(67281),I=i(86706),P=i(16550),B=i(99369),N=i(185),M=i(53979),Z=i(11047),U=i(29728),de=i(49066),r=i(41580),H=i(67109),C=i(94649),Me=i(27361),Ce=i.n(Me),h=i(86896),A=i(35650),J=i(18280),be=i(75515),ke=i(11276),Ee=i(67819),v=i(16364),ve=i(61467),Re=i(45697),G=i.n(Re);const ae=({disabled:_,role:W,values:$,errors:Y,onChange:ne,onBlur:ee})=>{const{formatMessage:K}=(0,h.Z)();return e.createElement(r.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(Z.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(Z.k,{justifyContent:"space-between"},e.createElement(r.x,null,e.createElement(r.x,null,e.createElement(be.Z,{fontWeight:"bold"},W?W.name:K({id:"global.details",defaultMessage:"Details"}))),e.createElement(r.x,null,e.createElement(be.Z,{textColor:"neutral500",variant:"pi"},W?W.description:K({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})))),e.createElement(U.z,{disabled:!0,variant:"secondary"},K({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:W.usersCount}))),e.createElement(ke.r,{gap:4},e.createElement(Ee.P,{col:6},e.createElement(v.o,{disabled:_,name:"name",error:Y.name&&K({id:Y.name}),label:K({id:"global.name",defaultMessage:"Name"}),onChange:ne,onBlur:ee,value:$.name||""})),e.createElement(Ee.P,{col:6},e.createElement(ve.g,{disabled:_,label:K({id:"global.description",defaultMessage:"Description"}),id:"description",error:Y.name&&K({id:Y.name}),onChange:ne,onBlur:ee},$.description||"")))))};ae.defaultProps={disabled:!1,role:null,values:{name:"",description:""}},ae.propTypes={disabled:G().bool,errors:G().object.isRequired,onBlur:G().func.isRequired,onChange:G().func.isRequired,role:G().object,values:G().object};const Le=ae;var ue=i(87561);const me=ue.object().shape({name:ue.string().required(O.translatedErrors.required)}),xe=()=>{const _=(0,O.useNotification)(),{formatMessage:W}=(0,h.Z)(),{params:{id:$}}=(0,P.$B)("/settings/roles/:id"),[Y,ne]=(0,e.useState)(!1),ee=(0,e.useRef)(),{lockApp:K,unlockApp:te}=(0,O.useOverlayBlocker)(),{trackUsage:je}=(0,O.useTracking)(),{isLoading:ge,data:Fe}=(0,A.U_)($),{role:re,permissions:Se,isLoading:Ae,onSubmitSucceeded:Ie}=(0,A.Dq)($),{put:Te}=(0,O.useFetchClient)(),Ge=async w=>{try{K(),ne(!0);const{permissionsToSend:L,didUpdateConditions:j}=ee.current.getPermissions();await Te(`/admin/roles/${$}`,w),re.code!=="strapi-super-admin"&&(await Te(`/admin/roles/${$}/permissions`,{permissions:L}),j&&je("didUpdateConditions")),ee.current.setFormAfterSubmit(),Ie({name:w.name,description:w.description}),_({type:"success",message:{id:"notification.success.saved"}})}catch(L){console.error(L.response);const j=Ce()(L,"response.payload.message","An error occured"),ie=Ce()(L,"response.payload.data.permissions[0]",j);_({type:"warning",message:ie})}finally{ne(!1),te()}},Pe=re.code==="strapi-super-admin";return e.createElement(N.o,null,e.createElement(O.SettingsPageTitle,{name:"Roles"}),e.createElement(C.Formik,{enableReinitialize:!0,initialValues:{name:re.name,description:re.description},onSubmit:Ge,validationSchema:me,validateOnChange:!1},({handleSubmit:w,values:L,errors:j,handleChange:ie,handleBlur:le})=>e.createElement("form",{onSubmit:w},e.createElement(M.T,{primaryAction:e.createElement(Z.k,{gap:2},e.createElement(U.z,{disabled:re.code==="strapi-super-admin",onClick:w,loading:Y,size:"L"},W({id:"global.save",defaultMessage:"Save"}))),title:W({id:"Settings.roles.edit.title",defaultMessage:"Edit a role"}),subtitle:W({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:e.createElement(O.Link,{startIcon:e.createElement(H.Z,null),to:"/settings/roles"},W({id:"global.back",defaultMessage:"Back"}))}),e.createElement(de.D,null,e.createElement(Z.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(Le,{isLoading:Ae,disabled:Pe,errors:j,values:L,onChange:ie,onBlur:le,role:re}),!ge&&!Ae?e.createElement(r.x,{shadow:"filterShadow",hasRadius:!0},e.createElement(J.Z,{isFormDisabled:Pe,permissions:Se,ref:ee,layout:Fe})):e.createElement(r.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(O.LoadingIndicatorPage,null)))))))},R=()=>{const _=(0,I.useSelector)(B._),{isLoading:W,allowedActions:{canRead:$,canUpdate:Y}}=(0,O.useRBAC)({read:_.settings.roles.read,update:_.settings.roles.update});return W?e.createElement(O.LoadingIndicatorPage,null):!$&&!Y?e.createElement(P.l_,{to:"/"}):e.createElement(xe,null)}},44174:Q=>{function q(i,e,O,I){for(var P=-1,B=i==null?0:i.length;++P<B;){var N=i[P];e(I,N,O(N),i)}return I}Q.exports=q},81119:(Q,q,i)=>{var e=i(89881);function O(I,P,B,N){return e(I,function(M,Z,U){P(N,M,B(M),U)}),N}Q.exports=O},55189:(Q,q,i)=>{var e=i(44174),O=i(81119),I=i(67206),P=i(1469);function B(N,M){return function(Z,U){var de=P(Z)?e:O,r=M?M():{};return de(Z,N,I(U,2),r)}}Q.exports=B},42348:(Q,q,i)=>{var e=i(21078),O=1/0;function I(P){var B=P==null?0:P.length;return B?e(P,O):[]}Q.exports=I},7739:(Q,q,i)=>{var e=i(89465),O=i(55189),I=Object.prototype,P=I.hasOwnProperty,B=O(function(N,M,Z){P.call(N,Z)?N[Z].push(M):e(N,Z,[M])});Q.exports=B}}]);
