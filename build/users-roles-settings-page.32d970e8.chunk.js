(self.webpackChunkmynote=self.webpackChunkmynote||[]).push([[8853],{20400:(R,S,t)=>{"use strict";t.r(S),t.d(S,{default:()=>xt});var e=t(53547),p=t(16550),r=t(67281),l=t(31498),c=t(81912),y=t(14087),f=t(17034),C=t(185),T=t(53979),A=t(29728),M=t(36989),P=t(49066),I=t(38939),B=t(8060),U=t(79031),D=t(37909),v=t(75515),K=t(63237),G=t(96315),x=t(86896),z=t(88767),Q=t(89031);const Le=async(n,a)=>{try{const{get:s}=(0,r.getFetchClient)(),{data:o}=await s((0,Q.Gc)("roles"));return a("The roles have loaded successfully"),o}catch{throw n({type:"warning",message:{id:"notification.error"}}),new Error("error")}},Me=async(n,a)=>{try{const{del:s}=(0,r.getFetchClient)();await s(`${(0,Q.Gc)("roles")}/${n}`)}catch{a({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}};var Se=t(45697),Z=t.n(Se),xe=t(15234),O=t(11047),re=t(12028),Ze=t(4585),Oe=t(20022);const ne=({sortedRoles:n,canDelete:a,permissions:s,setRoleToDelete:o,onDelete:u})=>{const{formatMessage:i}=(0,x.Z)(),{push:h}=(0,p.k6)(),[m,E]=u,g=d=>a&&!["public","authenticated"].includes(d.type),b=d=>{o(d),E(!m)},L=d=>{h(`/settings/${l.Z}/roles/${d}`)};return e.createElement(xe.p,null,n?.map(d=>e.createElement(U.Tr,{key:d.name,...(0,r.onRowClick)({fn:()=>L(d.id)})},e.createElement(D.Td,{width:"20%"},e.createElement(v.Z,null,d.name)),e.createElement(D.Td,{width:"50%"},e.createElement(v.Z,null,d.description)),e.createElement(D.Td,{width:"30%"},e.createElement(v.Z,null,`${d.nb_users} ${i({id:"global.users",defaultMessage:"users"}).toLowerCase()}`)),e.createElement(D.Td,null,e.createElement(O.k,{justifyContent:"end",...r.stopPropagation},e.createElement(r.CheckPermissions,{permissions:s.updateRole},e.createElement(re.h,{onClick:()=>L(d.id),noBorder:!0,icon:e.createElement(Ze.Z,null),label:i({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:`${d.name}`})})),g(d)&&e.createElement(r.CheckPermissions,{permissions:s.deleteRole},e.createElement(re.h,{onClick:()=>b(d.id),noBorder:!0,icon:e.createElement(Oe.Z,null),label:i({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${d.name}`})})))))))},ke=ne;ne.defaultProps={canDelete:!1},ne.propTypes={onDelete:Z().array.isRequired,permissions:Z().object.isRequired,setRoleToDelete:Z().func.isRequired,sortedRoles:Z().array.isRequired,canDelete:Z().bool};const Ue=()=>{const{trackUsage:n}=(0,r.useTracking)(),{formatMessage:a,locale:s}=(0,x.Z)(),{push:o}=(0,p.k6)(),u=(0,r.useNotification)(),{notifyStatus:i}=(0,y.G)(),[{query:h}]=(0,r.useQueryParams)(),m=h?._q||"",[E,g]=(0,e.useState)(!1),[b,L]=(0,e.useState)(!1),[d,j]=(0,e.useState)();(0,r.useFocusWhenNavigate)();const W=(0,z.useQueryClient)(),k=(0,e.useMemo)(()=>({create:c.Z.createRole,read:c.Z.readRoles,update:c.Z.updateRole,delete:c.Z.deleteRole}),[]),{isLoading:N,allowedActions:{canRead:F,canDelete:w}}=(0,r.useRBAC)(k),{isLoading:Zt,data:{roles:Ae},isFetching:Ot}=(0,z.useQuery)("get-roles",()=>Le(u,i),{initialData:{},enabled:F}),{includes:Pe}=(0,r.useFilter)(s,{sensitivity:"base"}),Te=(0,r.useCollator)(s,{sensitivity:"base"}),De=Zt||Ot,kt=()=>{n("willCreateRole"),o(`/settings/${l.Z}/roles/new`)},Ut=()=>{g(!E)},Bt={roles:{id:(0,Q.OB)("Roles.empty"),defaultMessage:"You don't have any roles yet."},search:{id:(0,Q.OB)("Roles.empty.search"),defaultMessage:"No roles match the search."}},Gt=a({id:"global.roles",defaultMessage:"Roles"}),Nt=(0,z.useMutation)(H=>Me(H,u),{async onSuccess(){await W.invalidateQueries("get-roles")}}),Ft=async()=>{L(!0),await Nt.mutateAsync(d),g(!E),L(!1)},te=(Ae||[]).filter(H=>Pe(H.name,m)||Pe(H.description,m)).sort((H,be)=>Te.compare(H.name,be.name)||Te.compare(H.description,be.description)),$t=m&&!te.length?"search":"roles",It=4,jt=(Ae?.length||0)+1;return e.createElement(f.A,null,e.createElement(r.SettingsPageTitle,{name:Gt}),e.createElement(C.o,{"aria-busy":De},e.createElement(T.T,{title:a({id:"global.roles",defaultMessage:"Roles"}),subtitle:a({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),primaryAction:e.createElement(r.CheckPermissions,{permissions:c.Z.createRole},e.createElement(A.z,{onClick:kt,startIcon:e.createElement(G.default,null),size:"S"},a({id:(0,Q.OB)("List.button.roles"),defaultMessage:"Add new role"})))}),e.createElement(M.Z,{startActions:e.createElement(r.SearchURLQuery,{label:a({id:"app.component.search.label",defaultMessage:"Search"})})}),e.createElement(P.D,null,!F&&e.createElement(r.NoPermissions,null),(De||N)&&e.createElement(r.LoadingIndicatorPage,null),F&&te&&te?.length?e.createElement(I.i,{colCount:It,rowCount:jt},e.createElement(B.h,null,e.createElement(U.Tr,null,e.createElement(D.Th,null,e.createElement(v.Z,{variant:"sigma",textColor:"neutral600"},a({id:"global.name",defaultMessage:"Name"}))),e.createElement(D.Th,null,e.createElement(v.Z,{variant:"sigma",textColor:"neutral600"},a({id:"global.description",defaultMessage:"Description"}))),e.createElement(D.Th,null,e.createElement(v.Z,{variant:"sigma",textColor:"neutral600"},a({id:"global.users",defaultMessage:"Users"}))),e.createElement(D.Th,null,e.createElement(K.T,null,a({id:"global.actions",defaultMessage:"Actions"}))))),e.createElement(ke,{sortedRoles:te,canDelete:w,permissions:c.Z,setRoleToDelete:j,onDelete:[E,g]})):e.createElement(r.EmptyStateLayout,{content:Bt[$t]})),e.createElement(r.ConfirmDialog,{isConfirmButtonLoading:b,onConfirm:Ft,onToggleDialog:Ut,isOpen:E})))},Be=()=>e.createElement(r.CheckPagePermissions,{permissions:c.Z.accessRoles},e.createElement(Ue,null));var oe=t(94649),$=t(41580),q=t(11276),V=t(67819),ie=t(16364),le=t(61467),ce=t(85018),Ge=t(67109),X=t(84757),Ne=t(27361),J=t.n(Ne),Fe=t(41609),$e=t.n(Fe),Ie=t(82569),je=t.n(Ie);const de=(0,e.createContext)({}),ue=({children:n,value:a})=>e.createElement(de.Provider,{value:a},n),se=()=>(0,e.useContext)(de);ue.propTypes={children:Z().node.isRequired,value:Z().object.isRequired};var _=t(54863),We=t(35161),Ve=t.n(We),He=t(13217),ze=t.n(He);const Qe=n=>{switch(n){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},Xe=(0,_.default)($.x)`
  margin: -1px;
  border-radius: ${({theme:n})=>n.spaces[1]} 0 0 ${({theme:n})=>n.spaces[1]};
`;function ae({route:n}){const{formatMessage:a}=(0,x.Z)(),{method:s,handler:o,path:u}=n,i=u?ze()(u.split("/")):[],[h="",m=""]=o?o.split("."):[],E=Qe(n.method);return e.createElement(O.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(v.Z,{variant:"delta",as:"h3"},a({id:"users-permissions.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",e.createElement("span",null,h),e.createElement(v.Z,{variant:"delta",textColor:"primary600"},".",m)),e.createElement(O.k,{hasRadius:!0,background:"neutral0",borderColor:"neutral200",gap:0},e.createElement(Xe,{background:E.background,borderColor:E.border,padding:2},e.createElement(v.Z,{fontWeight:"bold",textColor:E.text},s)),e.createElement($.x,{paddingLeft:2,paddingRight:2},Ve()(i,g=>e.createElement(v.Z,{key:g,textColor:g.includes(":")?"neutral600":"neutral900"},"/",g)))))}ae.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},ae.propTypes={route:Z().shape({handler:Z().string,method:Z().string,path:Z().string})};const Ye=ae,we=()=>{const{formatMessage:n}=(0,x.Z)(),{selectedAction:a,routes:s}=se(),o=je()(a.split("."),"controllers"),u=J()(s,o[0]),i=o.slice(1).join("."),h=$e()(u)?[]:u.filter(m=>m.handler.endsWith(i));return e.createElement(V.P,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"}},a?e.createElement(O.k,{direction:"column",alignItems:"stretch",gap:2},h.map((m,E)=>e.createElement(Ye,{key:E,route:m}))):e.createElement(O.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(v.Z,{variant:"delta",as:"h3"},n({id:"users-permissions.Policies.header.title",defaultMessage:"Advanced settings"})),e.createElement(v.Z,{as:"p",textColor:"neutral600"},n({id:"users-permissions.Policies.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"}))))};var Je=t(48734),Ke=t(74756),qe=t(63081),_e=t(11700),et=t.n(_e);function tt(n){switch(n){case"application":return"Application";case"plugin::content-manager":return"Content manager";case"plugin::content-type-builder":return"Content types builder";case"plugin::documentation":return"Documentation";case"plugin::email":return"Email";case"plugin::i18n":return"i18n";case"plugin::upload":return"Upload";case"plugin::users-permissions":return"Users-permissions";default:return et()(n.replace("api::","").replace("plugin::",""))}}const nt=tt;var st=t(89734),me=t.n(st),ge=t(36213),at=t(78114);const pe=(0,_.css)`
  background: ${n=>n.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`,rt=(0,_.default)($.x)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${n=>n.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${n=>n.isActive&&pe}
  &:hover {
    ${pe}
  }
`,ot=_.default.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:n})=>n.colors.neutral150};
`,Ee=({subCategory:n})=>{const{formatMessage:a}=(0,x.Z)(),{onChange:s,onChangeSelectAll:o,onSelectedAction:u,selectedAction:i,modifiedData:h}=se(),m=(0,e.useMemo)(()=>J()(h,n.name,{}),[h,n]),E=(0,e.useMemo)(()=>Object.values(m).every(d=>d.enabled===!0),[m]),g=(0,e.useMemo)(()=>Object.values(m).some(d=>d.enabled===!0)&&!E,[m,E]),b=(0,e.useCallback)(({target:{name:d}})=>{o({target:{name:d,value:!E}})},[E,o]),L=(0,e.useCallback)(d=>i===d,[i]);return e.createElement($.x,null,e.createElement(O.k,{justifyContent:"space-between",alignItems:"center"},e.createElement($.x,{paddingRight:4},e.createElement(v.Z,{variant:"sigma",textColor:"neutral600"},n.label)),e.createElement(ot,null),e.createElement($.x,{paddingLeft:4},e.createElement(ge.X,{name:n.name,value:E,onValueChange:d=>b({target:{name:n.name,value:d}}),indeterminate:g},a({id:"app.utils.select-all",defaultMessage:"Select all"})))),e.createElement(O.k,{paddingTop:6,paddingBottom:6},e.createElement(q.r,{gap:2,style:{flex:1}},n.actions.map(d=>{const j=`${d.name}.enabled`;return e.createElement(V.P,{col:6,key:d.name},e.createElement(rt,{isActive:L(d.name),padding:2,hasRadius:!0},e.createElement(ge.X,{value:J()(h,j,!1),name:j,onValueChange:W=>s({target:{name:j,value:W}})},d.label),e.createElement("button",{type:"button","data-testid":"action-cog",onClick:()=>u(d.name),style:{display:"inline-flex",alignItems:"center"}},e.createElement(at.Z,null))))}))))};Ee.propTypes={subCategory:Z().object.isRequired};const it=Ee,he=({name:n,permissions:a})=>{const s=(0,e.useMemo)(()=>me()(Object.values(a.controllers).reduce((o,u,i)=>{const h=`${n}.controllers.${Object.keys(a.controllers)[i]}`,m=me()(Object.keys(u).reduce((E,g)=>[...E,{...u[g],label:g,name:`${h}.${g}`}],[]),"label");return[...o,{actions:m,label:Object.keys(a.controllers)[i],name:h}]},[]),"label"),[n,a]);return e.createElement($.x,{padding:6},s.map(o=>e.createElement(it,{key:o.name,subCategory:o})))};he.propTypes={name:Z().string.isRequired,permissions:Z().object.isRequired};const lt=he,ct=(n,a)=>{const s=Object.keys(a).sort().map(o=>({name:o,isOpen:!1}));return{...n,collapses:s}};var ee=t(18172);const dt={collapses:[]},ut=(n,a)=>(0,ee.default)(n,s=>{switch(a.type){case"TOGGLE_COLLAPSE":{s.collapses=n.collapses.map((o,u)=>u===a.index?{...o,isOpen:!o.isOpen}:{...o,isOpen:!1});break}default:return s}}),mt=()=>{const{modifiedData:n}=se(),{formatMessage:a}=(0,x.Z)(),[{collapses:s},o]=(0,e.useReducer)(ut,dt,i=>ct(i,n)),u=i=>o({type:"TOGGLE_COLLAPSE",index:i});return e.createElement(O.k,{direction:"column",alignItems:"stretch",gap:1},s.map((i,h)=>e.createElement(Je.U,{expanded:i.isOpen,onToggle:()=>u(h),key:i.name,variant:h%2===0?"secondary":void 0},e.createElement(Ke.B,{title:nt(i.name),description:a({id:"users-permissions.Plugin.permissions.plugins.description",defaultMessage:"Define all allowed actions for the {name} plugin."},{name:i.name}),variant:h%2?"primary":"secondary"}),e.createElement(qe.v,null,e.createElement($.x,null,e.createElement(lt,{permissions:n[i.name],name:i.name}))))))};var gt=t(36968),fe=t.n(gt),pt=t(69572),Et=t.n(pt);const ht={initialData:{},modifiedData:{},routes:{},selectedAction:"",policies:[]},ft=(n,a)=>(0,ee.default)(n,s=>{switch(a.type){case"ON_CHANGE":{const o=a.keys.length,u=a.keys[o-1]==="enabled";if(a.value&&u){const i=Et()(a.keys,o-1).join(".");s.selectedAction=i}fe()(s,["modifiedData",...a.keys],a.value);break}case"ON_CHANGE_SELECT_ALL":{const o=["modifiedData",...a.keys],u=J()(n,o,{}),i=Object.keys(u).reduce((h,m)=>(h[m]={...u[m],enabled:a.value},h),{});fe()(s,o,i);break}case"ON_RESET":{s.modifiedData=n.initialData;break}case"ON_SUBMIT_SUCCEEDED":{s.initialData=n.modifiedData;break}case"SELECT_ACTION":{const{actionToSelect:o}=a;s.selectedAction=o===n.selectedAction?"":o;break}default:return s}}),yt=(n,a,s)=>({...n,initialData:a,modifiedData:a,routes:s}),ye=(0,e.forwardRef)(({permissions:n,routes:a},s)=>{const{formatMessage:o}=(0,x.Z)(),[u,i]=(0,e.useReducer)(ft,ht,b=>yt(b,n,a));(0,e.useImperativeHandle)(s,()=>({getPermissions(){return{permissions:u.modifiedData}},resetForm(){i({type:"ON_RESET"})},setFormAfterSubmit(){i({type:"ON_SUBMIT_SUCCEEDED"})}}));const g={...u,onChange:({target:{name:b,value:L}})=>i({type:"ON_CHANGE",keys:b.split("."),value:L==="empty__string_value"?"":L}),onChangeSelectAll:({target:{name:b,value:L}})=>i({type:"ON_CHANGE_SELECT_ALL",keys:b.split("."),value:L}),onSelectedAction:b=>i({type:"SELECT_ACTION",actionToSelect:b})};return e.createElement(ue,{value:g},e.createElement(q.r,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0"},e.createElement(V.P,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(O.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(O.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(v.Z,{variant:"delta",as:"h2"},o({id:(0,X.Z)("Plugins.header.title"),defaultMessage:"Permissions"})),e.createElement(v.Z,{as:"p",textColor:"neutral600"},o({id:(0,X.Z)("Plugins.header.description"),defaultMessage:"Only actions bound by a route are listed below."}))),e.createElement(mt,null))),e.createElement(we,null)))});ye.propTypes={permissions:Z().object.isRequired,routes:Z().object.isRequired};const Ce=(0,e.memo)(ye),Kt={isLoading:!0,modifiedData:{}},qt=(n,a)=>produce(n,s=>{switch(a.type){case"GET_DATA":{s.isLoading=!0,s.modifiedData={};break}case"GET_DATA_SUCCEEDED":{s.isLoading=!1,s.modifiedData=a.data;break}case"GET_DATA_ERROR":{s.isLoading=!0;break}case"ON_SUBMIT_SUCCEEDED":{s.modifiedData=a.data;break}default:return s}}),_t=null,en=(n,a)=>{const{isLoading:s,allowedActions:o}=useRBAC(a),[{isLoading:u,modifiedData:i},h]=useReducer(reducer,initialState),m=useNotification(),E=useRef(!0),{get:g}=useFetchClient();useEffect(()=>(s||(async()=>{try{h({type:"GET_DATA"});const{data:d}=await g(getRequestURL(n));h({type:"GET_DATA_SUCCEEDED",data:d})}catch(d){E.current&&(h({type:"GET_DATA_ERROR"}),console.error(d),m({type:"warning",message:{id:"notification.error"}}))}})(),()=>{E.current=!1}),[s,n,g,m]);const b=useCallback(L=>{h({type:"ON_SUBMIT_SUCCEEDED",data:L})},[]);return{allowedActions:o,dispatchSubmitSucceeded:b,isLoading:u,isLoadingForPermissions:s,modifiedData:i}},tn=null,nn={roles:[],isLoading:!0},sn=(n,a)=>produce(n,s=>{switch(a.type){case"GET_DATA":{s.isLoading=!0,s.roles=[];break}case"GET_DATA_SUCCEEDED":{s.roles=a.data,s.isLoading=!1;break}case"GET_DATA_ERROR":{s.isLoading=!1;break}default:return s}}),an=null,rn=(n=!0)=>{const[{roles:a,isLoading:s},o]=useReducer(reducer,initialState,()=>init(initialState,n)),u=useNotification(),i=useRef(!0),h=useFetchClient(),m=useCallback(async()=>{try{o({type:"GET_DATA"});const{data:{roles:E}}=await h.get(`/${pluginId}/roles`);o({type:"GET_DATA_SUCCEEDED",data:E})}catch(E){const g=get(E,["response","payload","message"],"An error occured");i.current&&(o({type:"GET_DATA_ERROR"}),g!=="Forbidden"&&u({type:"warning",message:g}))}},[h,u]);return useEffect(()=>(n&&m(),()=>{i.current=!1}),[n,m]),{roles:a,isLoading:s,getData:m}},on=null,Ct=(n,a)=>({...n,isLoading:a}),Re={permissions:{},routes:{},isLoading:!0},Rt=(n,a)=>(0,ee.default)(n,s=>{switch(a.type){case"GET_DATA":{s.isLoading=!0,s.permissions={},s.routes={};break}case"GET_DATA_SUCCEEDED":{s.permissions=a.permissions,s.routes=a.routes,s.isLoading=!1;break}case"GET_DATA_ERROR":{s.isLoading=!1;break}default:return s}}),ve=(n=!0)=>{const a=(0,r.useNotification)(),[{permissions:s,routes:o,isLoading:u},i]=(0,e.useReducer)(Rt,Re,()=>Ct(Re,n)),h=(0,r.useFetchClient)(),m=(0,e.useCallback)(async()=>{try{i({type:"GET_DATA"});const[{permissions:E},{routes:g}]=await Promise.all([`/${l.Z}/permissions`,`/${l.Z}/routes`].map(async b=>(await h.get(b)).data));i({type:"GET_DATA_SUCCEEDED",permissions:(0,Q.YX)(E),routes:g})}catch(E){const g=J()(E,["response","payload","message"],"An error occured");i({type:"GET_DATA_ERROR"}),g!=="Forbidden"&&a({type:"warning",message:g})}},[a]);return(0,e.useEffect)(()=>{n&&m()},[m,n]),{permissions:s,routes:o,getData:m,isLoading:u}},vt={role:{},isLoading:!0},At=(n,a)=>(0,ee.default)(n,s=>{switch(a.type){case"GET_DATA_SUCCEEDED":{s.role=a.role,s.isLoading=!1;break}case"GET_DATA_ERROR":{s.isLoading=!1;break}case"ON_SUBMIT_SUCCEEDED":{s.role.name=a.name,s.role.description=a.description;break}default:return s}}),Pt=n=>{const[a,s]=(0,e.useReducer)(At,vt),o=(0,r.useNotification)(),u=(0,e.useRef)(null),{get:i}=(0,r.useFetchClient)();(0,e.useEffect)(()=>(u.current=!0,n?h(n):s({type:"GET_DATA_SUCCEEDED",role:{}}),()=>u.current=!1),[n]);const h=async E=>{try{const{data:{role:g}}=await i(`/${l.Z}/roles/${E}`);u.current&&s({type:"GET_DATA_SUCCEEDED",role:g})}catch(g){console.error(g),s({type:"GET_DATA_ERROR"}),o({type:"warning",message:{id:"notification.error"}})}},m=(0,e.useCallback)(E=>{s({type:"ON_SUBMIT_SUCCEEDED",...E})},[]);return{...a,onSubmitSucceeded:m}};var Y=t(87561);const Tt=Y.object().shape({name:Y.string().required(r.translatedErrors.required),description:Y.string().required(r.translatedErrors.required)}),Dt=()=>{const{formatMessage:n}=(0,x.Z)(),[a,s]=(0,e.useState)(!1),o=(0,r.useNotification)(),{lockApp:u,unlockApp:i}=(0,r.useOverlayBlocker)(),{params:{id:h}}=(0,p.$B)(`/settings/${l.Z}/roles/:id`),{isLoading:m,routes:E}=ve(),{role:g,onSubmitSucceeded:b,isLoading:L}=Pt(h),d=(0,e.useRef)(),{put:j}=(0,r.useFetchClient)(),W=async k=>{u(),s(!0);try{const N=d.current.getPermissions();await j(`/${l.Z}/roles/${h}`,{...k,...N,users:[]}),b({name:k.name,description:k.description}),o({type:"success",message:{id:(0,X.Z)("Settings.roles.edited"),defaultMessage:"Role edited"}})}catch(N){console.error(N),o({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}s(!1),i()};return L?e.createElement(r.LoadingIndicatorPage,null):e.createElement(C.o,null,e.createElement(r.SettingsPageTitle,{name:"Roles"}),e.createElement(oe.Formik,{enableReinitialize:!0,initialValues:{name:g.name,description:g.description},onSubmit:W,validationSchema:Tt},({handleSubmit:k,values:N,handleChange:F,errors:w})=>e.createElement(r.Form,{noValidate:!0,onSubmit:k},e.createElement(T.T,{primaryAction:!m&&e.createElement(A.z,{disabled:g.code==="strapi-super-admin",type:"submit",loading:a,startIcon:e.createElement(ce.default,null)},n({id:"global.save",defaultMessage:"Save"})),title:g.name,subtitle:g.description,navigationAction:e.createElement(r.Link,{startIcon:e.createElement(Ge.Z,null),to:"/settings/users-permissions/roles"},n({id:"global.back",defaultMessage:"Back"}))}),e.createElement(P.D,null,e.createElement(O.k,{direction:"column",alignItems:"stretch",gap:7},e.createElement($.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(O.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(v.Z,{variant:"delta",as:"h2"},n({id:(0,X.Z)("EditPage.form.roles"),defaultMessage:"Role details"})),e.createElement(q.r,{gap:4},e.createElement(V.P,{col:6},e.createElement(ie.o,{name:"name",value:N.name||"",onChange:F,label:n({id:"global.name",defaultMessage:"Name"}),error:w.name?n({id:w.name,defaultMessage:"Invalid value"}):null})),e.createElement(V.P,{col:6},e.createElement(le.g,{id:"description",value:N.description||"",onChange:F,label:n({id:"global.description",defaultMessage:"Description"}),error:w.description?n({id:w.description,defaultMessage:"Invalid value"}):null}))))),!m&&e.createElement(Ce,{ref:d,permissions:g.permissions,routes:E}))))))},bt=()=>e.createElement(r.CheckPagePermissions,{permissions:c.Z.updateRole},e.createElement(Dt,null)),Lt=Y.object().shape({name:Y.string().required(r.translatedErrors.required),description:Y.string().required(r.translatedErrors.required)}),Mt=()=>{const{formatMessage:n}=(0,x.Z)(),[a,s]=(0,e.useState)(!1),o=(0,r.useNotification)(),{goBack:u}=(0,p.k6)(),{lockApp:i,unlockApp:h}=(0,r.useOverlayBlocker)(),{isLoading:m,permissions:E,routes:g}=ve(),{trackUsage:b}=(0,r.useTracking)(),L=(0,e.useRef)(),{post:d}=(0,r.useFetchClient)(),j=async W=>{i(),s(!0);try{const k=L.current.getPermissions();await d(`/${l.Z}/roles`,{...W,...k,users:[]}),b("didCreateRole"),o({type:"success",message:{id:(0,X.Z)("Settings.roles.created"),defaultMessage:"Role created"}}),u()}catch(k){console.error(k),o({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}s(!1),h()};return e.createElement(C.o,null,e.createElement(r.SettingsPageTitle,{name:"Roles"}),e.createElement(oe.Formik,{enableReinitialize:!0,initialValues:{name:"",description:""},onSubmit:j,validationSchema:Lt},({handleSubmit:W,values:k,handleChange:N,errors:F})=>e.createElement(r.Form,{noValidate:!0,onSubmit:W},e.createElement(T.T,{primaryAction:!m&&e.createElement(A.z,{type:"submit",loading:a,startIcon:e.createElement(ce.default,null)},n({id:"global.save",defaultMessage:"Save"})),title:n({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:n({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"})}),e.createElement(P.D,null,e.createElement(O.k,{direction:"column",alignItems:"stretch",gap:7},e.createElement($.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(O.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(v.Z,{variant:"delta",as:"h2"},n({id:(0,X.Z)("EditPage.form.roles"),defaultMessage:"Role details"})),e.createElement(q.r,{gap:4},e.createElement(V.P,{col:6},e.createElement(ie.o,{name:"name",value:k.name||"",onChange:N,label:n({id:"global.name",defaultMessage:"Name"}),error:F.name?n({id:F.name,defaultMessage:"Invalid value"}):null})),e.createElement(V.P,{col:6},e.createElement(le.g,{id:"description",value:k.description||"",onChange:N,label:n({id:"global.description",defaultMessage:"Description"}),error:F.description?n({id:F.description,defaultMessage:"Invalid value"}):null}))))),!m&&e.createElement(Ce,{ref:L,permissions:E,routes:g}))))))},St=()=>e.createElement(r.CheckPagePermissions,{permissions:c.Z.createRole},e.createElement(Mt,null)),xt=()=>e.createElement(r.CheckPagePermissions,{permissions:c.Z.accessRoles},e.createElement(p.rs,null,e.createElement(p.AW,{path:`/settings/${l.Z}/roles/new`,component:St,exact:!0}),e.createElement(p.AW,{path:`/settings/${l.Z}/roles/:id`,component:bt,exact:!0}),e.createElement(p.AW,{path:`/settings/${l.Z}/roles`,component:Be,exact:!0}),e.createElement(p.AW,{path:"",component:r.AnErrorOccurred})))},89031:(R,S,t)=>{"use strict";t.d(S,{YX:()=>l,Gc:()=>f,OB:()=>C.Z});var e=t(41609),p=t.n(e);const l=T=>Object.keys(T).reduce((A,M)=>{const P=T[M].controllers,I=Object.keys(P).reduce((B,U)=>(p()(P[U])||(B[U]=P[U]),B),{});return p()(I)||(A[M]={controllers:I}),A},{});var c=t(31498);const f=T=>`/${c.Z}/${T}`;var C=t(84757)},20731:(R,S,t)=>{var e=t(88668),p=t(47443),r=t(1196),l=t(29932),c=t(7518),y=t(74757),f=200;function C(T,A,M,P){var I=-1,B=p,U=!0,D=T.length,v=[],K=A.length;if(!D)return v;M&&(A=l(A,c(M))),P?(B=r,U=!1):A.length>=f&&(B=y,U=!1,A=new e(A));e:for(;++I<D;){var G=T[I],x=M==null?G:M(G);if(G=P||G!==0?G:0,U&&x===x){for(var z=K;z--;)if(A[z]===x)continue e;v.push(G)}else B(A,x,P)||v.push(G)}return v}R.exports=C},89881:(R,S,t)=>{var e=t(47816),p=t(99291),r=p(e);R.exports=r},69199:(R,S,t)=>{var e=t(89881),p=t(98612);function r(l,c){var y=-1,f=p(l)?Array(l.length):[];return e(l,function(C,T,A){f[++y]=c(C,T,A)}),f}R.exports=r},82689:(R,S,t)=>{var e=t(29932),p=t(97786),r=t(67206),l=t(69199),c=t(71131),y=t(7518),f=t(85022),C=t(6557),T=t(1469);function A(M,P,I){P.length?P=e(P,function(D){return T(D)?function(v){return p(v,D.length===1?D[0]:D)}:D}):P=[C];var B=-1;P=e(P,y(r));var U=l(M,function(D,v,K){var G=e(P,function(x){return x(D)});return{criteria:G,index:++B,value:D}});return c(U,function(D,v){return f(D,v,I)})}R.exports=A},71131:R=>{function S(t,e){var p=t.length;for(t.sort(e);p--;)t[p]=t[p].value;return t}R.exports=S},26393:(R,S,t)=>{var e=t(33448);function p(r,l){if(r!==l){var c=r!==void 0,y=r===null,f=r===r,C=e(r),T=l!==void 0,A=l===null,M=l===l,P=e(l);if(!A&&!P&&!C&&r>l||C&&T&&M&&!A&&!P||y&&T&&M||!c&&M||!f)return 1;if(!y&&!C&&!P&&r<l||P&&c&&f&&!y&&!C||A&&c&&f||!T&&f||!M)return-1}return 0}R.exports=p},85022:(R,S,t)=>{var e=t(26393);function p(r,l,c){for(var y=-1,f=r.criteria,C=l.criteria,T=f.length,A=c.length;++y<T;){var M=e(f[y],C[y]);if(M){if(y>=A)return M;var P=c[y];return M*(P=="desc"?-1:1)}}return r.index-l.index}R.exports=p},99291:(R,S,t)=>{var e=t(98612);function p(r,l){return function(c,y){if(c==null)return c;if(!e(c))return r(c,y);for(var f=c.length,C=l?f:-1,T=Object(c);(l?C--:++C<f)&&y(T[C],C,T)!==!1;);return c}}R.exports=p},35161:(R,S,t)=>{var e=t(29932),p=t(67206),r=t(69199),l=t(1469);function c(y,f){var C=l(y)?e:r;return C(y,p(f,3))}R.exports=c},89734:(R,S,t)=>{var e=t(21078),p=t(82689),r=t(5976),l=t(16612),c=r(function(y,f){if(y==null)return[];var C=f.length;return C>1&&l(y,f[0],f[1])?f=[]:C>2&&l(f[0],f[1],f[2])&&(f=[f[0]]),p(y,e(f,1),[])});R.exports=c},13217:(R,S,t)=>{var e=t(14259);function p(r){var l=r==null?0:r.length;return l?e(r,1,l):[]}R.exports=p},69572:(R,S,t)=>{var e=t(14259),p=t(40554);function r(l,c,y){return l&&l.length?(c=y||c===void 0?1:p(c),e(l,0,c<0?0:c)):[]}R.exports=r},82569:(R,S,t)=>{var e=t(20731),p=t(5976),r=t(29246),l=p(function(c,y){return r(c)?e(c,y):[]});R.exports=l}}]);
