"use strict";(self.webpackChunkmynote=self.webpackChunkmynote||[]).push([[4263],{50935:(K,c,e)=>{e.d(c,{R:()=>l});var t=e(67281),a=e(80129),i=e(88767);function l(u={},o={}){const{id:s="",...m}=u,d=(0,a.stringify)(m,{encode:!1}),{get:r}=(0,t.useFetchClient)(),{data:n,isError:h,isLoading:D,refetch:O}=(0,i.useQuery)(["users",s,m],async()=>{const{data:{data:A}}=await r(`/admin/users/${s}${d?`?${d}`:""}`);return A},o);let g=[];return s&&n?g=[n]:Array.isArray(n?.results)&&(g=n.results),{users:g,pagination:n?.pagination??null,isLoading:D,isError:h,refetch:O}}},22282:(K,c,e)=>{e.r(c),e.d(c,{default:()=>ve});var t=e(53547),a=e(67281),i=e(86706),l=e(16550),u=e(99369),o=e(87462),s=e(15861),m=e(70885),d=e(64687),r=e.n(d),n=e(185),h=e(53979),D=e(29728),O=e(49066),g=e(41580),A=e(11047),U=e(75515),T=e(11276),F=e(67819),x=e(85018),N=e(67109),V=e(94649),I=e(27361),G=e.n(I),b=e(57557),J=e.n(b),k=e(78718),X=e.n(k),y=e(45697),le=e.n(y),de=e(86896),ce=e(50935),w=e(19631),ue=e(81288),me=e(17405);const ge=async(Z,B)=>{const{put:R}=(0,a.getFetchClient)(),{data:W}=await R(`/admin/users/${Z}`,B);return W.data},pe=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.username.label",defaultMessage:"Username"},name:"username",placeholder:{id:"Auth.form.username.placeholder",defaultMessage:"e.g. Kai_Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"global.password",defaultMessage:"Password"},name:"password",type:"password",size:{col:6,xs:12},autoComplete:"new-password"},{intlLabel:{id:"Auth.form.confirmPassword.label",defaultMessage:"Password confirmation"},name:"confirmPassword",type:"password",size:{col:6,xs:12},autoComplete:"new-password"}],[{intlLabel:{id:"Auth.form.active.label",defaultMessage:"Active"},name:"isActive",type:"bool",size:{col:6,xs:12}}]];var Ee=function(){return window&&window.strapi&&window.strapi.isEE?e(12201).Z:e(31605).Z}(),q=["email","firstname","lastname","username","isActive","roles"],ee=function(B){var R=B.canUpdate,W=(0,de.Z)(),f=W.formatMessage,S=(0,l.$B)("/settings/users/:id"),z=S.params.id,_=(0,l.k6)(),Me=_.push,he=(0,a.useAppInfo)(),Pe=he.setUserDisplayName,Y=(0,a.useNotification)(),te=(0,a.useOverlayBlocker)(),ye=te.lockApp,Ae=te.unlockApp;(0,a.useFocusWhenNavigate)();var ae=(0,ce.R)({id:z},{onError:function(v){var E=v.response.status;E===403?(Y({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}}),Me("/")):Y({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),Le=(0,m.Z)(ae.users,1),P=Le[0],se=ae.isLoading,De=function(){var p=(0,s.Z)(r().mark(function v(E,C){var $,H,Q,L,re;return r().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return ye(),M.prev=1,M.next=4,ge(z,J()(E,"confirmPassword"));case 4:$=M.sent,Y({type:"success",message:f({id:"notification.success.saved",defaultMessage:"Saved"})}),H=a.auth.getUserInfo(),z.toString()===H.id.toString()&&(a.auth.setUserInfo($),Q=G()(E,"username")||(0,w.Pp)(E.firstname,E.lastname),Pe(Q)),C.setValues(X()(E,q)),M.next=17;break;case 11:M.prev=11,M.t0=M.catch(1),L=(0,w.Iz)(M.t0.response.data),re=Object.keys(L).reduce(function(oe,ie){return oe[ie]=L[ie].id,oe},{}),C.setErrors(re),Y({type:"warning",message:G()(M.t0,"response.data.error.message","notification.error")});case 17:Ae();case 18:case"end":return M.stop()}},v,null,[[1,11]])}));return function(E,C){return p.apply(this,arguments)}}(),Oe=se?{id:"app.containers.Users.EditPage.header.label-loading",defaultMessage:"Edit user"}:{id:"app.containers.Users.EditPage.header.label",defaultMessage:"Edit {name}"},j=Object.keys(X()(P,q)).reduce(function(p,v){return v==="roles"?(p[v]=(P?.roles||[]).map(function(E){var C=E.id;return C}),p):(p[v]=P?.[v],p)},{}),Te=j.username||(0,w.Pp)(j.firstname,j.lastname),ne=f(Oe,{name:Te});return se?t.createElement(n.o,{"aria-busy":"true"},t.createElement(a.SettingsPageTitle,{name:"Users"}),t.createElement(h.T,{primaryAction:t.createElement(D.z,{disabled:!0,startIcon:t.createElement(x.default,null),type:"button",size:"L"},f({id:"global.save",defaultMessage:"Save"})),title:ne,navigationAction:t.createElement(a.Link,{startIcon:t.createElement(N.Z,null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},f({id:"global.back",defaultMessage:"Back"}))}),t.createElement(O.D,null,t.createElement(a.LoadingIndicatorPage,null))):t.createElement(n.o,null,t.createElement(a.SettingsPageTitle,{name:"Users"}),t.createElement(V.Formik,{onSubmit:De,initialValues:j,validateOnChange:!1,validationSchema:me.YM},function(p){var v=p.errors,E=p.values,C=p.handleChange,$=p.isSubmitting,H=p.dirty;return t.createElement(a.Form,null,t.createElement(h.T,{primaryAction:t.createElement(D.z,{disabled:$||!R?!0:!H,startIcon:t.createElement(x.default,null),loading:$,type:"submit",size:"L"},f({id:"global.save",defaultMessage:"Save"})),title:ne,navigationAction:t.createElement(a.Link,{startIcon:t.createElement(N.Z,null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},f({id:"global.back",defaultMessage:"Back"}))}),t.createElement(O.D,null,P?.registrationToken&&t.createElement(g.x,{paddingBottom:6},t.createElement(Ee,{registrationToken:P.registrationToken})),t.createElement(A.k,{direction:"column",alignItems:"stretch",gap:7},t.createElement(g.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(A.k,{direction:"column",alignItems:"stretch",gap:4},t.createElement(U.Z,{variant:"delta",as:"h2"},f({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"Details"})),t.createElement(T.r,{gap:5},pe.map(function(Q){return Q.map(function(L){return t.createElement(F.P,(0,o.Z)({key:L.name},L.size),t.createElement(a.GenericInput,(0,o.Z)({},L,{disabled:!R,error:v[L.name],onChange:C,value:E[L.name]||""})))})})))),t.createElement(g.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(A.k,{direction:"column",alignItems:"stretch",gap:4},t.createElement(U.Z,{variant:"delta",as:"h2"},f({id:"global.roles",defaultMessage:"User's role"})),t.createElement(T.r,{gap:5},t.createElement(F.P,{col:6,xs:12},t.createElement(ue.Z,{disabled:!R,error:v.roles,onChange:C,value:E.roles}))))))))}))};ee.propTypes={canUpdate:le().bool.isRequired};const fe=ee,ve=()=>{const Z=(0,a.useNotification)(),B=(0,i.useSelector)(u._),R=t.useMemo(()=>({read:B.settings.users.read,update:B.settings.users.update}),[B.settings.users]),{isLoading:W,allowedActions:{canRead:f,canUpdate:S}}=(0,a.useRBAC)(R),{state:z}=(0,l.TH)(),_=z?.from??"/";return(0,t.useEffect)(()=>{W||!f&&!S&&Z({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}})},[W,f,S,Z]),W?t.createElement(a.LoadingIndicatorPage,null):!f&&!S?t.createElement(l.l_,{to:_}):t.createElement(fe,{canUpdate:S})}},82464:(K,c,e)=>{e.d(c,{Z:()=>d});var t=e(53547),a=e(12028),i=e(67281),l=e(65186),u=e(45697),o=e.n(u),s=e(86896);const m=({children:r,target:n})=>{const h=(0,i.useNotification)(),{formatMessage:D}=(0,s.Z)(),{copy:O}=(0,i.useClipboard)(),g=D({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),A=async()=>{await O(n)&&h({type:"info",message:{id:"notification.link-copied"}})};return t.createElement(i.ContentBox,{endAction:t.createElement(a.h,{label:g,noBorder:!0,icon:t.createElement(l.Z,null),onClick:A}),title:n,titleEllipsis:!0,subtitle:r,icon:t.createElement("span",{style:{fontSize:32}},"\u2709\uFE0F"),iconBackground:"neutral100"})};m.propTypes={children:o().oneOfType([o().element,o().string]).isRequired,target:o().string.isRequired};const d=m},31605:(K,c,e)=>{e.d(c,{Z:()=>m});var t=e(53547),a=e(45697),i=e.n(a),l=e(86896),u=e(63871),o=e(82464);const s=({registrationToken:d})=>{const{formatMessage:r}=(0,l.Z)(),n=`${window.location.origin}${u.Z}auth/register?registrationToken=${d}`;return t.createElement(o.Z,{target:n},r({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"}))};s.defaultProps={registrationToken:""},s.propTypes={registrationToken:i().string};const m=s},81288:(K,c,e)=>{e.d(c,{Z:()=>A});var t=e(53547),a=e(40619),i=e(82562),l=e(67281),u=e(86647),o=e(45697),s=e.n(o),m=e(86896),d=e(88767),r=e(54863);const n=(0,r.keyframes)`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,h=r.default.div`
  animation: ${n} 2s infinite linear;
`,D=()=>t.createElement(h,null,t.createElement(u.Z,null)),O=async()=>{const{get:U}=(0,l.getFetchClient)(),{data:T}=await U("/admin/roles");return T.data},g=({disabled:U,error:T,onChange:F,value:x})=>{const{status:N,data:V}=(0,d.useQuery)(["roles"],O,{staleTime:5e4}),{formatMessage:I}=(0,m.Z)(),G=T?I({id:T,defaultMessage:T}):"",b=I({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),J=I({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),k=I({id:"app.components.Select.placeholder",defaultMessage:"Select"}),X=N==="loading"?t.createElement(D,null):void 0;return t.createElement(a.P,{id:"roles",disabled:U,error:G,hint:J,label:b,name:"roles",onChange:y=>{F({target:{name:"roles",value:y}})},placeholder:k,multi:!0,startIcon:X,value:x.map(y=>y.toString()),withTags:!0,required:!0},(V||[]).map(y=>t.createElement(i.W,{key:y.id,value:y.id.toString()},I({id:`global.${y.code}`,defaultMessage:y.name}))))};g.defaultProps={disabled:!1,error:void 0},g.propTypes={disabled:s().bool,error:s().string,onChange:s().func.isRequired,value:s().array.isRequired};const A=g},17405:(K,c,e)=>{e.d(c,{YM:()=>d,Rw:()=>u});var t=e(87561),a=e(67281);const i={firstname:t.string().trim().required(a.translatedErrors.required),lastname:t.string(),email:t.string().email(a.translatedErrors.email).lowercase().required(a.translatedErrors.required),username:t.string().nullable(),password:t.string().min(8,a.translatedErrors.minLength).matches(/[a-z]/,"components.Input.error.contain.lowercase").matches(/[A-Z]/,"components.Input.error.contain.uppercase").matches(/\d/,"components.Input.error.contain.number"),confirmPassword:t.string().min(8,a.translatedErrors.minLength).oneOf([t.ref("password"),null],"components.Input.error.password.noMatch").when("password",(r,n)=>r?n.required(a.translatedErrors.required):n)},u={...i,currentPassword:t.string().when(["password","confirmPassword"],(r,n,h)=>r||n?h.required(a.translatedErrors.required):h),preferedLanguage:t.string().nullable()},s={roles:t.array().min(1,a.translatedErrors.required).required(a.translatedErrors.required)},d=t.object().shape({...i,isActive:t.bool(),...s})},12201:(K,c,e)=>{e.d(c,{Z:()=>m});var t=e(53547),a=e(45697),i=e.n(a),l=e(86896),u=e(63871),o=e(82464);const s=({registrationToken:d})=>{const{formatMessage:r}=(0,l.Z)();return d?t.createElement(o.Z,{target:`${window.location.origin}${u.Z}auth/register?registrationToken=${d}`},r({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"})):t.createElement(o.Z,{target:`${window.location.origin}${u.Z}auth/login`},r({id:"app.components.Users.MagicLink.connect.sso",defaultMessage:"Send this link to the user, the first login can be made via a SSO provider."}))};s.defaultProps={registrationToken:""},s.propTypes={registrationToken:i().string};const m=s}}]);
